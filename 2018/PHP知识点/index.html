<!DOCTYPE html>
<html lang="zh-CN">

  
<head>
  <meta charset="utf-8">
  <meta name="author" content="johnscott" />
  
  
  
  <title>PHP知识点 | JohnScott1989的博客</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="PHP,面试," />
  

  <script>
    console.log('\n%c Hexo-theme-bmw v4.0 ' + '%c 🎉 https://github.com/dongyuanxin/theme-bmw 🎉\n' + '\n%c View demo online ' + '%c 🔍 https://godbmw.com/ 🔍  \n' , 'color: #fadfa3; background: #030307; padding:3px 0;', '', 'color: #fadfa3; background: #030307; padding:3px 0;', '');
  </script>

  
    <meta name="description" content="超级帽子戏法的个人博客,主要记录复制粘贴过来的笔记,还有自己的一些心得体会">
  

  

  
    <link rel="icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/touch-icon.png">
  

  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/icon/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">


  
<script src="/js/util.js"></script>
<script src="/js/valine.min.js"></script>


  

  
    <link href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js" async></script>
  

  
    <link href="https://cdn.bootcss.com/social-share.js/1.0.16/css/share.min.css" rel="stylesheet">
  
  
  <script src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js" async></script>
  
  
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.11.0/dist/av-min.js"></script>
  

<meta name="generator" content="Hexo 5.1.1"></head>

  <body>

    

    <div id="app">

      <div class="header-wrap">
  <header>
    <div class="site-brand">
      <div class="site-title">
        <a href="/">JohnScott1989</a>
      </div>
    </div>
    <nav class="site-navigation">
      <ul class="nav-menu">
      
        <li class="nav-item" data-path="/">
          
            <a 
              href="/"
              target="_self"
            >
              主页
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/archives/">
          
            <a 
              href="/archives/"
              target="_self"
            >
              归档
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/categories/">
          
            <a 
              href="/categories/"
              target="_self"
            >
              分类
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/tags/">
          
            <a 
              href="/tags/"
              target="_self"
            >
              标签
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/friends/">
          
            <a 
              href="/friends/"
              target="_self"
            >
              友链
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/about/">
          
            <a 
              href="/about/"
              target="_self"
            >
              关于
            </a>
          
        </li>
      
        <li class="nav-item" data-path="">
          
            <a href="javascript:void(0);" v-else>联系我</a>
            <ul class="nav-menu--dropdown">
              
                <li>
                  <a 
                    href="https://github.com/liuxue5213" 
                    target="_blank"
                  >
                    Github
                  </a>
                </li>
              
                <li>
                  <a 
                    href="https://www.zhihu.com/people/liuxue5213" 
                    target="_blank"
                  >
                    知乎
                  </a>
                </li>
              
                <li>
                  <a 
                    href="http://weibo.com/liuxue5213" 
                    target="_blank"
                  >
                    微博
                  </a>
                </li>
              
                <li>
                  <a 
                    href="https://www.douban.com/people/liuxue5213" 
                    target="_blank"
                  >
                    豆瓣
                  </a>
                </li>
              
                <li>
                  <a 
                    href="/linkedin.com/in/liuxue5213" 
                    target="_blank"
                  >
                    linkedin
                  </a>
                </li>
              
            </ul>
          
        </li>
      
      </ul>
    </nav>
    <i class="iconfont icon-menu"></i>
  </header>
</div>

<script>
  let links = document.querySelectorAll('.nav-item');
  for(let link of links){
    let childrenLink = link.querySelector('ul');
    link.addEventListener('mouseenter', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown active";
      }
    })
    link.addEventListener('mouseleave', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown";
      }
    })
  }
  let rootRealPath = getRealPath(window.location.pathname, true);
  for(let link of links) {
    let linkPath = link.getAttribute("data-path");
    if(linkPath && getRealPath(linkPath, true) === rootRealPath) {
      link.className = "nav-item hover";
    }
  }

  let iconMenu = document.querySelector("i.iconfont.icon-menu"),
    iconMenuClicked = false;
  let navDOM = document.querySelector("nav.site-navigation");
  iconMenu.addEventListener("click", () => {
    iconMenuClicked 
      ? navDOM.className = "site-navigation active"
      : navDOM.className = "site-navigation";
    iconMenuClicked = !iconMenuClicked;
  })
</script>

      








<div class="container post-index">

  

<div class="post">
  <h1 class="article-title">
    <span>PHP知识点</span>
  </h1>
  <div class="article-top-meta">
    <span>
      发布 : 
      2018-07-12
    </span>
    
      <span>
        分类 : 
          <a href="/categories/PHP/">
            PHP
          </a>
      </span>
    
    
      <span>
        浏览 : <span class="article-timer" data-identity="PHP知识点"></span>
      </span>
    
  </div>

  

  <div class="article-content">
    <div class="markdown-body">
      <p>1、PHP基础<br>PHP引用变量<br>常量及数据类型<br>运算符<br>流程控制<br>自定义函数及内部函数<br>正则表达式<br>文件及目录处理<br>会话控制<br>面向对象</p>
<p>2、JS JQUERY AJAX<br>变量定义：变量必须以字母 $ _ 开头、变量名大小写敏感、可以使用var 来定义变量、未使用值来声明的变量是undefined<br>数据类型：字符串、布尔、数组、对象、null、undefined。JavaScript变量均为对象，声明一个变量时，就创建了一个对象<br>函数的定义<br>JavaScript内置对象<br>JavaScript dom对象<br>jquery基础知识；  jquery选择器；  jquery事件；jquery 效果<br>ajax技术用了什么协议，简述ajax的工作机制？  ajax的工作原理，xmlhttprequest 是ajax的基础，用于在后台与服务器交换数据<br>xmlhttprequest对象， .open()方法，send();响应：responseText,responseXml</p>
<p>3、LINUX基础<br>linux常用命令；系统定时任务；vi/vim 编辑器；shell基础；<br>系统安全类：sudo、su、chmod、setfacl<br>进程管理：w、top、ps、kill、pkill、pstree、killall<br>用户管理：id、usermod、useradd、groupadd、userdel<br>文件系统：mount、umount、fsck、df、du<br>系统关机：shutdown、reboot<br>网络应用：curl、telnet、mail、elinks<br>网络测试：ping、netstat、host<br>网络配置：hostname、ifconfig<br>常用工具：ssh、screen、clear、who、date<br>软件包管理：yum、rpm、apt-get<br>文件查找和比较：locat、find<br>文件内容查看：head、tail、less、more<br>文件处理：touch、unlink、rename、ln、cat<br>目录操作：cd、mv、rm、pwd、tree、cp、ls<br>文件权限属性：setfacl、chmod、chown、chgrp<br>压缩解压：tar、bzip2/bunzip2、gzip/gunzip、zip/unzip</p>
<p>linux系统的定时任务：crontab 命令<br>crontab -e  : * * * * * 命令(分 时 日 月 周)；<br>at命令：at 2:00 tomorrow<br>shell编写：开头用#！指定脚本解释器、例如：#!/bin/sh</p>
<p>4、MySQL数据库<br>mysql数据类型；mysql基础操作；mysql存储引擎；mysql锁机制；mysql事务处理、存储过程、触发器<br>整数类型：TINYINT、SMALLINT、MEDIUMINT、INT、BIGINT<br>属性UNSIGNED；长度：可以为整数类型指定宽<br>实数类型：FLOAT DOUBLE 、DECIMAL；decimal可以存储比BIGINT还大的整数，可用于存储精确小数，FLOAT和DOUBLE类型支持使用标准的浮点数进行近似计算<br>字符串类型：varchar、char、text、blob；varchar类型用于存储可变类型的字符串，他比定长类型更节省空间。varchar使用1或2个额外字节记录字符串长度，列长度小于255字节，使用一个字节表示，否则两个；varchar长度，如果存储内容超出指定长度，会被截断；char是定长的，根据定义的字符串长度分配足够的空间，char会根据需要采用空格进行填充以方便比较；char适合存储很短的字符串，或者所有值都接近一个长度；char超出设定的长度会被截断；对于经常变更的数据char比varchar更好，因为char不容易产生碎片；对于非常短的列，char比varchar在存储空间上更有效率；尽量避免使用blob和text类型，查询会使用临时表，导致严重的性能开销<br>枚举：有时可以使用枚举代替常使用的字符串类型；枚举内部实际使用整形存储；尽量避免使用数字作为枚举的常量，容易混乱；排序是按照内部存储的整数进行排序的<br>日期和时间类型：尽量使用timestamp，比datetime空间效率高<br>列属性：AUTO_INCREMENT、default、not null、zerofill</p>
<p>msyql的连接和关闭：mysql -u（指定用户） -p（指定密码） -P(指定端口) -h（指定主机）<br>表引擎：<br>InnoDB表引擎：默认的事务性引擎，最重要最广泛的存储引擎，性能优秀；对主键的查询性能高于其他类型存储引擎；内部做了很多优化，从磁盘读取数据时自动在内存构建hash索引，插入数据时自动构建插入缓冲区；通过工具和机制支持真正热备份；支持崩溃后的恢复；支持行级锁；支持外键<br>MyISAM表引擎：拥有全文索引、压缩、空间函数；不支持事务和行级锁、不支持崩溃后的安全恢复；设计简单，某些场景下性能很好<br>mysql锁机制：共享锁和排它锁其实就是读锁和写锁<br>读锁：共享的，不堵塞，多个用户可以同时读一个资源互不干扰<br>写锁：排他的，一个写锁堵塞其他的写锁和读锁，这样可以只允许一个人进行写入，防止其他用户读取正在写入的资源<br>锁粒度：<br>表锁：系统性能开销小，会锁定整张表，MyISAM使用表锁<br>行锁：最大程度的支持并发处理，但是带来做大的锁开销，InnoDB实行行级锁<br>事务处理：mysql提供事务处理的表引擎是InnoDB。服务器层不管理事务，又下层的引擎实现；在非事务表上执行事务不报错<br>存储过程：<br>触发器：</p>
<p>简单描述mysql中，索引、主键、唯一索引、联合索引的区别，对数据库性能有什么影响；<br>一个表只能有一个主键索引，可以又多个唯一索引；主键索引一定是唯一索引，唯一索引不是主键索引；主键索引可以与外键构成参照完整性约束，放置数据不一致</p>
<p>mysql索引的基础和类型；普通索引：最近本的索引，没有任何约束限制；唯一索引:与普通索引类似，但是具有唯一性约束；主键索引:特殊的唯一索引，不允许有空值；组合索引：将多个列组合在一起创建索引，可以覆盖多个列；外键索引：InnoDB有；全文索引：MyISAM有，英文</p>
<p>mysql索引的创建原则；最适合索引的列是where子句中的列或者连接子句中的列；索引列的基数越大，索引效果越好；对字符串进行索引，应该制定一个前缀长度，可以节省大量索引空间；根据情况创建复合索引；避免创建过多的索引，索引回额外占用磁盘空间，降低写操作效率；主键尽可能选择较短的数据类型，可以减少索引的磁盘占用</p>
<p>mysql创建索引的注意事项；复合索引遵循前缀选择（最左原则）；like查询 %不能在前，可以使用全文索引；column is null 可以使用索引；如果mysql估计使用索引比全表扫描更慢，会放弃使用索引；如果or前的条件中列有索引，后面的没有索引，索引都不会用到；列类型是字符创类型，查询时一定要给值加引号，否则索引会实效</p>
<p>索引对性能的影响：大大减少服务器的扫描量；帮助服务器避免排序和创建临时表；将随机io变顺序io；大大提高查询速度，降低写速度，占用磁盘</p>
<p>索引使用场景：对于非常小的表，大部分情况下，全表扫描效率更高；对于中大型表，索引非常有效；特大型表，建立和使用索引的代价将随之增大，可以使用分区技术来解决</p>
<p>mysql关联查询语句；六种关联查询：交叉连接（cross join），内连接（inner join）， 外连接（left join/right join），联合查询（union  与 union all），全连接（full join）</p>
<p>交叉连接：SELECT * from a，b，(c….)或者 SELECT * from a cross join b （cross join c）,没有任何关联条件，结果是笛卡尔积，结果集会很大，没有意义，很少使用<br>内连接：SELECT *from a，b where a.id=b.id 或者 SELECT * from a inner join b on a.id=b.id；多表中同时符合某种条件的数据记录集合<br>内连接分为三类：1.等值连接，on a.id=b.id ，2不等值连接：on a.id&gt;b.id 3.自连接 select * from a t1 inner join a t2 on t1.id=t2.pid<br>联合查询：select <em>from a union select·</em>from b union 就是把多节结果集集合在一起<br>全连接：mysql不支持全连接，可以使用left join 和union  和right join 联合使用，select * from a left Join b on a.id=b.id union select * from a right join b on a.id=b.id<br>嵌套查询：用一条sql语句结果作为另一条sql的条件，select *from a where id in（select id from b）</p>
<p>pt-query-digest工具进行分析<br>优化查询过程中的数据访问<br>优化长难的查询语句<br>优化特定类型的查询语句</p>
<p>分区表的原理:对用户而言，分区表是一个独立的逻辑表，但是底层mysql将其分成多个物理子表，这对用户而言是透明的，每一个分区表都会使用一个独立的表文件；工作原理：创建表时使用partition by 子句定义每个分区存放的数据，执行查询时，优化器会根据分区定义 过滤那些没有我么需要数据的分区；适用场景：1.表非常大，无法全部存储到内存，或者只在表的最后有热点数据，其他都是历史数据。2分区表的数据更容易维护，可以对独立分区进行独立操作 3.分区表的数据可以分布在不同的机器上，从而高效的使用资源。4 可以使用分区表来避免某些特殊的瓶颈 5.可以备份和恢复独立的分区。 限制：1.一个表最多有1024个分区 2.5.1版本中分区表达式必须为整数，5.5可以使用列分区。3.分区字段中如果有主键和唯一索引列，那么主键和都必须包含进来 。4.分区表中 不能使用外键约束。 5 需要对先有表的结构进行修改 。 6 所有分区都必须使用相同的存储引擎；7.分区函数中可以使用的函数和表达式会有一些限制。8 某些存储引擎不支持分区 9 对于MyISAM分区表，不能使用load index into cache </p>
<p>分库分表的原理; 工作原理，通过一些hash算法或者工具实现将一张数据表垂直或者水平进行物理切分；适用场景，1.单表记录达到百万或者千万级别，2 解决表锁问题， 分表方式  ：分水平分割:表很大，分割后可以降低在查询时需要读的数据或索引的页数，同时页降低了索引的层数，提高查询速度。 水平分割适用场景,  1.表中的数据本身就有独立性，例如表中分别记录各个地区的数据或者不同时期的数据，特别是有些常用有些不常用。2. 需要把数据存放在多个介质上。水平切分的缺点，1 给应用增加复杂度，通常查询时需要多个表名，查询所有数据需要union操作。2.在许多数据库应用中，这种复杂度会超过他带来的优点，查询时会增加一个索引层的磁盘次数  ；  垂直分割： 使用场景 1，一个表中 有些列常用 有些列不常用，2.可以使数据行变小，一个数据页可以存储更多的数据，查询时减少io次数；垂直分表缺点: 管理冗余列，查询所有数据时需要join操作； 分表缺点： 有些分表是基于应用层逻辑算法，一旦逻辑算法改变，真个分表逻辑都会改变，扩展性较差， 逻辑层增加开发成本</p>
<p>5、PHP框架<br>MVC框架基础工作原理：model数据模型层、view视图层、controller逻辑层<br>单一入口的工作原理：用一个处理程序文件处理所有的http请求，根据请求的参数不同区分不同的操作模块和操作的请求；缺点处理效率稍低<br>模板引擎的理解:PHP是一种html内嵌式在服务端执行的脚本语言，但是PHP有很多可以是PHP代码和html代码分开的模板引擎，例如：smarty、twig、haml、liquid；工作原理： 模板引擎就是庞大的完善的正则表达式替换库<br>常用框架优缺点</p>
<p>6、高并发解决方案<br>qps：每秒钟请求或者查询的数量，在互联网领域，值每秒的响应的请求数<br>吞吐量：单位时间内处理的请求数量（通常由qps 与并发数决定）<br>响应时间：从发出请求到收到响应花费的时间<br>pv：综合浏览量（page view ），即页面浏览量或者点击量，一个访客在24小时内访问的页面数量。同一个人流量一个网站的一个页面算一个pv<br>uv：独立访客（unique visitor），即一定的时间范围内，相同的访客多次访问网站，只计算为1个独立访客<br>带宽：计算带宽大小需要关注两个指标，峰值流量和页面的平均大小<br>日网站带宽 = pv/统计时间（换算到秒）* 平均页面大小（单位kb）* 8<br>并发连接数 qps 不等于并发连接数，qps是每秒http请求数量，并发连接数是系统同时处理的请求数<br>峰值每秒请求数 = （总pv数<em>80%）/(6小时秒数</em>20) ， 含义80%的访问量集中在20%的时间。6小时是简单的估值<br>压力测试：测试能承受的最大并发、测试最大承受的qps<br>常用的性能测试工具：ab、wrk、http_load、web bench 、 siege、Apache jmeter</p>
<p>qps达到极限 ： qps50 ：小型网站，一般的服务器就可以应付；<br>qps达到100：假设关系型数据库的每次请求在0.01秒内完成，假设单页面只有一个sql查询，那么100qps意味着1秒钟完成100次请求，但是此时我们并不能保证数据库查询能完成100次，所以达到极限，优化方案：数据库缓存层、数据库负载均衡。<br>qps达到800：假设我们使用的百兆带宽，意味着网站出口的实际带宽是8M左右，假设每个页面只有10k，这个并发条件下，百兆的带宽已经吃完。方案：cdn加速、负载均衡。<br>qps达到1000, 假设使用memcache 缓存数据库查询，每个页面对memcache的请求远大于对db的请求，memcahe的悲观并发数在2W左右，但有可能在这之前内网带宽已经吃光，表现出不稳定。方案：静态html缓存。<br>qps达到2000 在这个级别下 文件系统访问锁都成为灾难。方案：做业务分离，分布式存储。</p>
<p>优化方案：<br>web服务器优化：负载均衡<br>流量优化：防盗链处理 将恶意请求屏蔽<br>前端优化：减少http请求、添加异步请求、启用浏览器缓存和文件压缩、cdn加速、建立独立的图片服务器<br>服务端优化：页面静态化、并发处理、队列处理<br>数据库优化：数据库缓存、分库分表、分区操作 、读写分离、负载均衡</p>
<p>web资源防盗链：通过referer方法 使用nginx 模块ngx_http_referer_module 用于阻挡来源非法的域名请求，nginx指令valid_referers,全局变量$invalid_referer.问题 可以伪装referer。 使用加密签名， 使用第三方模块httpAccessModule实现反盗链<br>减少HTTP请求<br>浏览器缓存及压缩优化<br>CND加速<br>独立图片服务器<br>动态语言静态化<br>数据缓存层优化<br>MySQL数据层优化<br>web服务器负载均衡 请求兵法<br>7、算法 数据结构<br>常见算法：<br>冒泡排序 : 原理两两相邻的数进行比较，如果反序就交换否则不交换<br>插入排序。希尔排序 原理 把待排序的数据根据增量分成几个子序列，对子序列进行插入排序，直到增量为1，直接进行插入排；增量的排序一般是数组长度的一半，再变为原来增量的一半，直到增量为1<br>选择排序  原理每次从待排序的数据元素中选择出最小的或者最大的放在序列的起始位置，直到全部待排序的数据用完，时间复杂 o（n^2）空间复杂度o（1）<br>快速排序 原理 通过一趟排序将要排序的数据分割成两个独立的部分，其中一部分的数据比另一部分的数据都要小，然后再按照此方法对这两部分的数据分别进行排序，整个排序过程可以递归完成<br>堆排序 原理 把待排序的元素按照大小在二叉树上进行排序，排序好的元素要满足：父节点的元素大于等于子节点，这个过程叫堆化过程，如果根节点存放的最大数，则叫做最大堆，如果是最小数则叫最小堆，可以吧根节点拿出然后再堆化，循环到最后一个节点<br>归并排序 原理 将两个或者两个以上有序表合并成一个有序表，即把待排序列分成若干有序的子序列，再把有序子序列合并成整体有序序列<br>二分查找 原理 从数组的中间元素开始，如果中间元素正好是要查找的元素，搜索结束，如果某一个特定元素大于或者小于，则在数组大于或者小于中间元素的那一半数据中查找，如果某一步数组变空了，代表没有数据</p>
<p>时间复杂度和空间复杂度概念 ： 算法评定 时间复杂度<br>效率o(1)&gt;o(log2n)&gt;o(n)&gt;o(nlog2n)&gt;o(n^2)&gt;o(n^3)&gt;o(2^n)&gt;o(n!)&gt;o(n^n)   空间复杂度<br>常见数据结构<br>array 使用连续的内存来存储，数组中的所有元素必须是相同的元素或者类型的衍生（同质数据结构），元素可以通过下标直接访问<br>linked-list：链表<br>stack 栈<br>heap 堆，一般情况下，堆叫二叉堆，近似完全二叉树的数据结构<br>list 线性表<br>doubly-liked-list 双向链表<br>queue：队列<br>set：集合 保存不重复的元素<br>map：字典<br>graph：图  通常使用邻接矩阵和邻接表 表示，前者易实现但是对于稀疏矩阵会浪费较多空间，后者使用链表的方式存储信息 但是对于图搜索时间复杂度较高<br>模拟内置函数的实现<br>字符串open_door转换成OpenDoor、make_by_id 转换成MakeById、反转字符串</p>

    </div>
  </div>
  
    <div class="copy-right">
      <div class="markdown-body">
        <blockquote>
        
        
          本文作者 : JohnScott <br/>
        
        原文链接 : <a href="">https://github.com/liuxue5213/liuxue5213.github.io/2018/PHP%E7%9F%A5%E8%AF%86%E7%82%B9/</a><br>
        版权声明 : 本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
        </blockquote>
      </div>
    </div>
  
  
  
    <div class="social-share"
  style="margin-top: -2rem"
  data-wechat-qrcode-title="<p>微信扫一扫</p>"
  data-wechat-qrcode-helper="<p>微信右上角, 扫一扫分享</p>"
   data-sites="qzone, qq, weibo, wechat, douban, google, facebook, twitter" 
  
>
  <span style="color: #6b7487; font-size: 1.4rem;">分享到: </span>
</div>
<script src="https://cdn.bootcss.com/social-share.js/1.0.16/js/social-share.min.js" async>
  

  
    <div id="reward">
  
    <p id="reward-meta">知识 & 情怀 | 二者兼得</p>
  
  <button id="reward-btn">
    
    <span>感谢您的关心</span>
  </button>
  <div id="reward-qrcode">
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/wechat.png" alt="微信扫一扫">
        <p class="qrcode-meta">微信扫一扫</p>
      </div>
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/alipay.png" alt="支付宝扫一扫">
        <p class="qrcode-meta">支付宝扫一扫</p>
      </div>
    
  </div>

</div>

<script>
  (() => {
    let button = document.querySelector('#reward-btn'),
      qrcode = document.querySelector('#reward-qrcode'),
      display = false;
    
    button.addEventListener('click', () => {
      qrcode.style.display = display ? 'none' : 'block'
      display = !display
    }, false)
  })()
</script>
  

  <div class="article-footer">
    <div class="article-meta pull-left">
      <span>
        
          <i class="iconfont icon-06tags"></i>标签: 
          
          <span class="span--tag">
            <a href="/tags/%E9%9D%A2%E8%AF%95/">
              #面试
            </a>
          </span>
          
        
      </span>
    </div>
    <div class="article-meta pull-right">
    </div>
  </div>
</div>


  <aside id="sidebar">
    <p id="sidebar-header"></p>
    <ol id="sidebar-toc"></ol>
  </aside>
  <script async>setTimeout(generateToc, 10);</script>


  <nav class="post-navigation">
    
      <div class="nav-pre">
        <i class="iconfont icon-prev"></i>
        上一篇:
        <a href="/2018/LINUX%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E7%9A%84%E5%91%BD%E4%BB%A4/" target="_self">Linux查看文件内容的命令</a>
      </div>
    
    
      <div class="nav-next">
        下一篇:
        <a href="/2018/%E5%9C%A8%E6%88%91%E5%A4%B1%E6%81%8B%E5%90%8E%E6%9C%80%E9%9A%BE%E8%BF%87%E7%9A%84%E9%82%A3%E6%AE%B5%E6%97%B6%E9%97%B4%E9%87%8C-%E7%BB%8F%E5%85%B8%E8%AF%AD%E5%BD%95/" target="_self">在我失恋后最难过的那段时间里-经典语录</a>
        <i class="iconfont icon-next"></i>
      </div>
    
  </nav>

  
    <a href="#comment" class="comment-anchor"></a>
<div class="comment-title"><i class="iconfont icon-footprint"></i> 留下足迹 <i class="iconfont icon-footprint"></i></div>
<div id="vcomments"></div>

<script defer>
  if( true ) {
    let path = getRealPath()
    new Valine({
      el: "#vcomments",
      appId: "E4f1KI8G9DKenPGcXCkfpCMV-gzGzoHsz",
      appKey: "6VNHrdDAu0JKJXxyMajHk6qD",
      notify: false,
      verify: false,
      avatar: "robohash",
      placeholder: "正确填写邮箱, 才能及时收到回复哦♪(^∇^*)",
      path
    });
  }
</script>
   

  
    <script defer>
const valineAPI = (() => {
  try {
    AV.init("E4f1KI8G9DKenPGcXCkfpCMV-gzGzoHsz", "6VNHrdDAu0JKJXxyMajHk6qD");
  } catch(error) {}
  const isExist = (identity) => {
    identity = identity || getRealPath();
    let query = new AV.Query('Timer');
    return new Promise((resolve, reject) => {
      query.equalTo("identity", identity);
      query.find().then(results => {
        resolve(results.length > 0);
      }, error => reject(error));
    })
  }

  const _get = (identity) => {
    let query = null;
    if(identity && identity instanceof Array){
      let querys = [];
      for(let i = 0; i < identity.length; ++i) {
        querys[i] = new AV.Query('Timer');
        querys[i].equalTo('identity', identity[i]);
      }
      query = AV.Query.or.apply(null ,querys);
    } else {
      identity = identity || getRealPath();
      query = new AV.Query("Timer");
      query.equalTo("identity", identity);
    }

    return new Promise((resolve, reject) => {
      query.find()
      .then(results => resolve(results))
      .catch(error => reject(error))
    })
  }

  const create = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let Todo = AV.Object.extend('Timer');
      let todo = new Todo();
      todo.set("times", 1);
      todo.set("identity", identity);
      todo.save().then(res => resolve(true), error => reject(error));
    })
  }

  const update = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let query = new AV.Query('Timer');
      query.equalTo("identity", identity);
      query.find().then(todos => {
        todos.forEach(todo => {
          todo.set("times", todo.attributes.times + 1);
        });
        return AV.Object.saveAll(todos);
      }).then(todos => resolve(true), error => reject(error));
    })
  }

  return {
    isExist,
    _get,
    update,
    create
  }
})()

const calcAndWriteTimes = () => {
  let isPost = true;

  let timerAllDOM = document.querySelectorAll(".article-timer");

  if(isPost) {
    let identity = timerAllDOM[0].getAttribute("data-identity");
    valineAPI.isExist(identity)
    .then(exist => {
      if(exist) {
        return valineAPI.update(identity);
      }
      return new Promise(resolve => resolve(true));
    })
    .then( succuess => valineAPI._get(identity))
    .then( result => timerAllDOM[0].innerText = result[0].attributes.times)
    .catch(error => console.log(error.message))
    return ;
  }

  let timerDOMCache = {};

  for(let timerDOM of timerAllDOM) {
    let identity = timerDOM.getAttribute("data-identity");
    if(timerDOMCache.hasOwnProperty(identity)){
      timerDOMCache[identity].dom.push(timerDOM);
    }else{
      timerDOMCache[identity] = {
        dom: [timerDOM],
        times: undefined
      };
    }
  }

  let identities = Object.keys(timerDOMCache);
  valineAPI._get(identities).then(results => {
    for(let result of results) {
      let {identity, times} = result.attributes;
      timerDOMCache[identity].times = times;
      timerDOMCache[identity].dom.map(item => item.innerText = times);
    }
    for(let identity of identities) {
      if(timerDOMCache[identity].times){
        continue;
      }
      timerDOMCache[identity].dom.map(item => item.innerText = 1);
      valineAPI.create(identity);
    }
  }).catch(error => console.log(error.message))
}

if(true){
  calcAndWriteTimes();
}
</script>
   

</div>


      <footer>
  <p class="site-info">
    博客已萌萌哒运行<span id="time-to-now"></span><span class="my-face">(●'◡'●)ﾉ♥</span>
    <br>
    Theme - <a href="https://github.com/dongyuanxin/theme-bmw">BMW</a> | Made With 💗 | Powered by <a target="_blank" rel="noopener" href="https://godbmw.com/">GodBMW</a>
    <br>
    
  </p>
</footer>



<script>
const timeToNowDOM = document.querySelector("#time-to-now");
const startTimestamp = new Date(2015, 0, 1).getTime();

const updateTimeStr = () => {
  let offset = parseInt(
      (new Date().getTime() - startTimestamp) / 1000,
      10
    ),
    day = Math.floor(offset / 86400),
    hour = Math.floor((offset % 86400) / 3600),
    minute = Math.floor(((offset % 86400) % 3600) / 60),
    second = Math.floor(((offset % 86400) % 3600) % 60);
  timeToNowDOM.innerHTML =
    day + "天" + hour + "小时" + minute + "分钟" + second + "秒";
  setTimeout(updateTimeStr, 500);
}

setTimeout(updateTimeStr, 500);
</script>


      <div class="back-to-top hidden">
  <span>
    <i class="iconfont icon-60"></i><span></span>%
  </span>
</div>

<script>
const updateIconToTop = percent => {
  let dom = document.querySelector(".back-to-top span span");
  dom.innerText = percent;
  if(percent < 1) {
    document.querySelector(".back-to-top").className = "back-to-top hidden";
  } else {
    document.querySelector(".back-to-top").className = "back-to-top";
  }
}

const handleScoll = () => {
  let isRunning = false;
  return () => {
    if (isRunning) return;
    isRunning = true;
    window.requestAnimationFrame(timestamp => {
      let scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop,
        scrollHeight =
          document.documentElement.scrollHeight ||
          document.body.scrollHeight,
        clientHeight =
          document.documentElement.clientHeight ||
          document.body.clientHeight;
      isRunning = false;
      if (scrollTop <= 1) {
        updateIconToTop(0);
        return;
      }
      if (scrollTop + clientHeight >= scrollHeight) {
        updateIconToTop(100);
      } else {
        updateIconToTop(parseInt(
          100 * scrollTop / (scrollHeight - clientHeight),
          10
        ));
      }
    });
  };
}

const backToTop = () => {
  let scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop,
    delay = 10,
    time = 200;
  if (scrollTop <= 20) {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
    return;
  }
  let step = Math.ceil(scrollTop * delay / time);
  let timer = setInterval(() => {
    scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop;
    if (scrollTop - step <= 0) {
      document.documentElement.scrollTop = 0;
      document.body.scrollTop = 0;
      clearInterval(timer);
    } else {
      document.documentElement.scrollTop = scrollTop - step;
      document.body.scrollTop = scrollTop - step;
    }
  }, delay);
}

document.addEventListener("scroll", handleScoll(), false);

document.querySelector(".back-to-top").addEventListener("click", backToTop, false);

</script>

    </div>

    
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  (() => {
    const mathjaxConfig = {
      showProcessingMessages: false, //关闭js加载过程信息
      messageStyle: "none", //不显示信息
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]], //行内公式选择符
        displayMath: [["$$", "$$"], ["\\[", "\\]"]], //段内公式选择符
        skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //避开某些标签
      },
      "HTML-CSS": {
        availableFonts: ["STIX", "TeX"], //可选字体
        showMathMenu: false //关闭右击菜单显示
      }
    }

    let mathjaxInterval = setInterval(() => {
      if(!window.MathJax){
        return;
      }
      window.MathJax.Hub.Config(mathjaxConfig)
      window.MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.getElementById('app')])

      clearInterval(mathjaxInterval)
    }, 10)    
  })()
</script>
    

    <script src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script>
<script async>
  let fancyTimer = setInterval(function(){
    if(!window.$){
      return;
    }
    $(document).ready(function() {
      $(".post img").each(function () {
        if($(this).parent().get(0).tagName.toLowerCase() === "a") {
          return;
        }
        // $(this).attr("data-fancybox", "gallery"); // if you add 'data-fancybox', img will display after showed
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "gallery");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      });
      
      clearInterval(fancyTimer);
    });
  }, 10);
</script>

    
  </body>

</html>
