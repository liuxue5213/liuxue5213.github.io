<!DOCTYPE html>
<html lang="zh-CN">

  
<head>
  <meta charset="utf-8">
  <meta name="author" content="johnscott" />
  
  
  
  <title>Metasploitä¿¡æ¯æœé›† | JohnScott2046çš„åšå®¢</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="ç½‘ç»œå®‰å…¨,Metasploit," />
  

  <script>
    console.log('\n%c Hexo-theme-bmw v4.0 ' + '%c ğŸ‰ https://github.com/dongyuanxin/theme-bmw ğŸ‰\n' + '\n%c View demo online ' + '%c ğŸ” https://godbmw.com/ ğŸ”  \n' , 'color: #fadfa3; background: #030307; padding:3px 0;', '', 'color: #fadfa3; background: #030307; padding:3px 0;', '');
  </script>

  
    <meta name="description" content="è¶…çº§å¸½å­æˆæ³•çš„ä¸ªäººåšå®¢,ä¸»è¦è®°å½•å¤åˆ¶ç²˜è´´è¿‡æ¥çš„ç¬”è®°,è¿˜æœ‰è‡ªå·±çš„ä¸€äº›å¿ƒå¾—ä½“ä¼š">
  

  

  
    <link rel="icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/touch-icon.png">
  

  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/icon/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">


  
<script src="/js/util.js"></script>
<script src="/js/valine.min.js"></script>


  

  
    <link href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js" async></script>
  

  
    <link href="https://cdn.bootcss.com/social-share.js/1.0.16/css/share.min.css" rel="stylesheet">
  
  
  <script src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js" async></script>
  
  
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.11.0/dist/av-min.js"></script>
  

<meta name="generator" content="Hexo 5.1.1"></head>

  <body>

    

    <div id="app">

      <div class="header-wrap">
  <header>
    <div class="site-brand">
      <div class="site-title">
        <a href="/">JohnScott2046</a>
      </div>
    </div>
    <nav class="site-navigation">
      <ul class="nav-menu">
      
        <li class="nav-item" data-path="/">
          
            <a 
              href="/"
              target="_self"
            >
              ä¸»é¡µ
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/archives/">
          
            <a 
              href="/archives/"
              target="_self"
            >
              å½’æ¡£
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/categories/">
          
            <a 
              href="/categories/"
              target="_self"
            >
              åˆ†ç±»
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/tags/">
          
            <a 
              href="/tags/"
              target="_self"
            >
              æ ‡ç­¾
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/friends/">
          
            <a 
              href="/friends/"
              target="_self"
            >
              å‹é“¾
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/about/">
          
            <a 
              href="/about/"
              target="_self"
            >
              å…³äº
            </a>
          
        </li>
      
        <li class="nav-item" data-path="">
          
            <a href="javascript:void(0);" v-else>è”ç³»æˆ‘</a>
            <ul class="nav-menu--dropdown">
              
                <li>
                  <a 
                    href="https://github.com/liuxue5213" 
                    target="_blank"
                  >
                    Github
                  </a>
                </li>
              
                <li>
                  <a 
                    href="https://www.zhihu.com/people/liuxue5213" 
                    target="_blank"
                  >
                    çŸ¥ä¹
                  </a>
                </li>
              
                <li>
                  <a 
                    href="http://weibo.com/liuxue5213" 
                    target="_blank"
                  >
                    å¾®åš
                  </a>
                </li>
              
                <li>
                  <a 
                    href="https://www.douban.com/people/liuxue5213" 
                    target="_blank"
                  >
                    è±†ç“£
                  </a>
                </li>
              
                <li>
                  <a 
                    href="/linkedin.com/in/liuxue5213" 
                    target="_blank"
                  >
                    linkedin
                  </a>
                </li>
              
            </ul>
          
        </li>
      
      </ul>
    </nav>
    <i class="iconfont icon-menu"></i>
  </header>
</div>

<script>
  let links = document.querySelectorAll('.nav-item');
  for(let link of links){
    let childrenLink = link.querySelector('ul');
    link.addEventListener('mouseenter', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown active";
      }
    })
    link.addEventListener('mouseleave', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown";
      }
    })
  }
  let rootRealPath = getRealPath(window.location.pathname, true);
  for(let link of links) {
    let linkPath = link.getAttribute("data-path");
    if(linkPath && getRealPath(linkPath, true) === rootRealPath) {
      link.className = "nav-item hover";
    }
  }

  let iconMenu = document.querySelector("i.iconfont.icon-menu"),
    iconMenuClicked = false;
  let navDOM = document.querySelector("nav.site-navigation");
  iconMenu.addEventListener("click", () => {
    iconMenuClicked 
      ? navDOM.className = "site-navigation active"
      : navDOM.className = "site-navigation";
    iconMenuClicked = !iconMenuClicked;
  })
</script>

      








<div class="container post-index">

  

<div class="post">
  <h1 class="article-title">
    <span>Metasploitä¿¡æ¯æœé›†</span>
  </h1>
  <div class="article-top-meta">
    <span>
      å‘å¸ƒ : 
      2021-05-13
    </span>
    
      <span>
        åˆ†ç±» : 
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">
            ç½‘ç»œå®‰å…¨
          </a>
      </span>
    
    
      <span>
        æµè§ˆ : <span class="article-timer" data-identity="13Metasploitä¿¡æ¯æœé›†"></span>
      </span>
    
  </div>

  

  <div class="article-content">
    <div class="markdown-body">
      <h2 id="Metasploitä¿¡æ¯æœé›†"><a href="#Metasploitä¿¡æ¯æœé›†" class="headerlink" title="Metasploitä¿¡æ¯æœé›†"></a>Metasploitä¿¡æ¯æœé›†</h2><h3 id="ä¸€ã€-ä¸»æ©Ÿç™¼ç¾"><a href="#ä¸€ã€-ä¸»æ©Ÿç™¼ç¾" class="headerlink" title="ä¸€ã€ ä¸»æ©Ÿç™¼ç¾"></a>ä¸€ã€ ä¸»æ©Ÿç™¼ç¾</h3><p>use auxiliary/scanner/discovery/arp_sweep</p>
<p>æ‰€æœ‰é¸æ“‡é …<br>show options</p>
<p>å¿…å¡«é …<br>show missing </p>
<p>è¨­ç½®ç›®æ¨™ç¶²æ®µ<br>set rhosts 192.168.1.0/24</p>
<p>è¨­ç½®ç·šç¨‹æ•¸é‡<br>set threads 10</p>
<p>å½é€ è«‹æ±‚ip<br>shost </p>
<p>å½é€ è«‹æ±‚mac<br>smac</p>
<p>è¶…æ™‚æ™‚é–“<br>timeout</p>
<p>run</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[+] 192.168.1.1 appears to be up (UNKNOWN).</span><br><span class="line">[+] 192.168.1.15 appears to be up (UNKNOWN).</span><br><span class="line">[+] 192.168.1.148 appears to be up (UNKNOWN).</span><br><span class="line">[+] 192.168.1.208 appears to be up (UNKNOWN).</span><br><span class="line">[+] 192.168.1.213 appears to be up (UNKNOWN).</span><br><span class="line">[+] 192.168.1.230 appears to be up (VMware, Inc.).</span><br><span class="line">[*] Scanned 256 of 256 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>

<h3 id="äºŒã€-ç«¯å£æƒæ"><a href="#äºŒã€-ç«¯å£æƒæ" class="headerlink" title="äºŒã€ ç«¯å£æƒæ"></a>äºŒã€ ç«¯å£æƒæ</h3><h4 id="tcpæ–¹å¼"><a href="#tcpæ–¹å¼" class="headerlink" title="tcpæ–¹å¼"></a>tcpæ–¹å¼</h4><p>use auxiliary/scanner/portscan/tcp </p>
<p>show options</p>
<p>set rhosts 192.168.1.1</p>
<h4 id="synæ–¹å¼"><a href="#synæ–¹å¼" class="headerlink" title="synæ–¹å¼"></a>synæ–¹å¼</h4><p>use auxiliary/scanner/portscan/syn </p>
<p>show options</p>
<p>set rhosts 192.168.1.1</p>
<h4 id="udpæ–¹å¼-æƒæä¸»æ©Ÿæ˜¯å¦åœ¨ç·š"><a href="#udpæ–¹å¼-æƒæä¸»æ©Ÿæ˜¯å¦åœ¨ç·š" class="headerlink" title="udpæ–¹å¼ æƒæä¸»æ©Ÿæ˜¯å¦åœ¨ç·š"></a>udpæ–¹å¼ æƒæä¸»æ©Ÿæ˜¯å¦åœ¨ç·š</h4><p>use auxiliary/scanner/discovery/udp_probe</p>
<p>show options</p>
<p>set rhosts 192.168.1.1</p>
<p>exploit</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[+] Discovered DNS on 192.168.1.230:53 (BIND 9.4.2)</span><br><span class="line">[+] Discovered NetBIOS on 192.168.1.230:137 (METASPLOITABLE:&lt;00&gt;:U :METASPLOITABLE:&lt;03&gt;:U :METASPLOITABLE:&lt;20&gt;:U :__MSBROWSE__:&lt;01&gt;:G :WORKGROUP:&lt;00&gt;:G :WORKGROUP:&lt;1d&gt;:U :WORKGROUP:&lt;1e&gt;:G :00:00:00:00:00:00)</span><br><span class="line">[+] Discovered Portmap on 192.168.1.230:111 (100000 v2 TCP(111), 100000 v2 UDP(111), 100024 v1 UDP(45898), 100024 v1 TCP(55535), 100003 v2 UDP(2049), 100003 v3 UDP(2049), 100003 v4 UDP(2049), 100021 v1 UDP(47866), 100021 v3 UDP(47866), 100021 v4 UDP(47866), 100003 v2 TCP(2049), 100003 v3 TCP(2049), 100003 v4 TCP(2049), 100021 v1 TCP(42883), 100021 v3 TCP(42883), 100021 v4 TCP(42883), 100005 v1 UDP(48681), 100005 v1 TCP(54768), 100005 v2 UDP(48681), 100005 v2 TCP(54768), 100005 v3 UDP(48681), 100005 v3 TCP(54768))</span><br><span class="line">[*] Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>

<h3 id="ä¸‰ã€-FTP"><a href="#ä¸‰ã€-FTP" class="headerlink" title="ä¸‰ã€ FTP"></a>ä¸‰ã€ FTP</h3><h4 id="æƒæç‰ˆæœ¬"><a href="#æƒæç‰ˆæœ¬" class="headerlink" title="æƒæç‰ˆæœ¬"></a>æƒæç‰ˆæœ¬</h4><p>use auxiliary/scanner/ftp/ftp_version</p>
<p>show options</p>
<p>set rhosts 192.168.1.1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+] 192.168.1.230:21      - FTP Banner: &#39;220 (vsFTPd 2.3.4)\x0d\x0a&#39;</span><br><span class="line">[*] 192.168.1.230:21      - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>

<h4 id="æƒæåŒ¿å"><a href="#æƒæåŒ¿å" class="headerlink" title="æƒæåŒ¿å"></a>æƒæåŒ¿å</h4><p>use auxiliary/scanner/ftp/anonymous </p>
<p>show options</p>
<p>set rhosts 192.168.1.1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+] 192.168.1.230:21      - 192.168.1.230:21 - Anonymous READ (220 (vsFTPd 2.3.4))</span><br><span class="line">[*] 192.168.1.230:21      - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>

<p>ncåŒ¿åç”¨æˆ¶<br>nc 192.168.1.230 21<br>USER anonymous<br>PASS 111</p>
<p><a href="ftp://192.168.1.230/">ftp://192.168.1.230</a></p>
<h4 id="æš´åŠ›ç ´è§£"><a href="#æš´åŠ›ç ´è§£" class="headerlink" title="æš´åŠ›ç ´è§£"></a>æš´åŠ›ç ´è§£</h4><p>è‡ªå¸¶çš„å­—å…¸ç›®éŒ„</p>
<p>cd /usr/share/metasploit-framework/data/wordlists/</p>
<p>use auxiliary/scanner/ftp/ftp_login</p>
<p>äºŒè€…éƒ½ä¸çŸ¥é“<br>set username  pass_file<br>set USERPASS_FILE</p>
<p>set rhosts 192.168.1.230</p>
<p>set username root</p>
<p>set pass_file /usr/share/metasploit-framework/data/wordlists/password.lst</p>
<p>show options</p>
<p>run</p>
<h3 id="å››ã€-SSH-linux"><a href="#å››ã€-SSH-linux" class="headerlink" title="å››ã€ SSH - linux"></a>å››ã€ SSH - linux</h3><h4 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h4><p>use auxiliary/scanner/ssh/ssh_version</p>
<p>show options</p>
<p>set rhosts 192.168.1.230</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+] 192.168.1.230:22      - SSH server version: SSH-2.0-OpenSSH_4.7p1 Debian-8ubuntu1 ( service.version&#x3D;4.7p1 openssh.comment&#x3D;Debian-8ubuntu1 service.vendor&#x3D;OpenBSD service.family&#x3D;OpenSSH service.product&#x3D;OpenSSH service.cpe23&#x3D;cpe:&#x2F;a:openbsd:openssh:4.7p1 os.vendor&#x3D;Ubuntu os.family&#x3D;Linux os.product&#x3D;Linux os.version&#x3D;8.04 os.cpe23&#x3D;cpe:&#x2F;o:canonical:ubuntu_linux:8.04 service.protocol&#x3D;ssh fingerprint_db&#x3D;ssh.banner )</span><br><span class="line">[*] 192.168.1.230:22      - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>

<h4 id="æš´åŠ›ç ´è§£-1"><a href="#æš´åŠ›ç ´è§£-1" class="headerlink" title="æš´åŠ›ç ´è§£"></a>æš´åŠ›ç ´è§£</h4><p>use auxiliary/scanner/ssh/ssh_login</p>
<p>set rhosts 192.168.1.230</p>
<p>show options</p>
<p>set USERPASS_FILE /usr/share/metasploit-framework/data/wordlists/root_userpass.txt</p>
<h3 id="äº”ã€-SMB"><a href="#äº”ã€-SMB" class="headerlink" title="äº”ã€ SMB"></a>äº”ã€ SMB</h3><p>use auxiliary/scanner/smb/smb_version</p>
<p>set rhosts 192.168.1.230</p>
<p>show options</p>
<p>set threads 10</p>
<p>run</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[*] 192.168.1.230:445     - SMB Detected (versions:1) (preferred dialect:) (signatures:optional)</span><br><span class="line">[*] 192.168.1.230:445     -   Host could not be identified: Unix (Samba 3.0.20-Debian)</span><br><span class="line">[*] 192.168.1.230:        - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>

<h3 id="å…­ã€-å¯†ç¢¼å—…æ¢"><a href="#å…­ã€-å¯†ç¢¼å—…æ¢" class="headerlink" title="å…­ã€ å¯†ç¢¼å—…æ¢"></a>å…­ã€ å¯†ç¢¼å—…æ¢</h3><p>use auxiliary/sniffer/psnuffle</p>
<p>ç›´æ¥é‹è¡Œ exploit</p>
<p>ç¨‹åºé»˜èªæœƒå¾Œå°ç¹¼çºŒé‹è¡Œ</p>
<p>é—œé–‰éœ€è¦ jobs  </p>
<p>ç„¶å¾Œ kill 0</p>
    </div>
  </div>
  
    <div class="copy-right">
      <div class="markdown-body">
        <blockquote>
        
        
          æœ¬æ–‡ä½œè€… : JohnScott <br/>
        
        åŸæ–‡é“¾æ¥ : <a href="">https://github.com/liuxue5213/liuxue5213.github.io/2021/13Metasploit%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/</a><br>
        ç‰ˆæƒå£°æ˜ : æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
        </blockquote>
      </div>
    </div>
  
  
  
    <div class="social-share"
  style="margin-top: -2rem"
  data-wechat-qrcode-title="<p>å¾®ä¿¡æ‰«ä¸€æ‰«</p>"
  data-wechat-qrcode-helper="<p>å¾®ä¿¡å³ä¸Šè§’, æ‰«ä¸€æ‰«åˆ†äº«</p>"
   data-sites="qzone, qq, weibo, wechat, douban, google, facebook, twitter" 
  
>
  <span style="color: #6b7487; font-size: 1.4rem;">åˆ†äº«åˆ°: </span>
</div>
<script src="https://cdn.bootcss.com/social-share.js/1.0.16/js/social-share.min.js" async>
  

  
    <div id="reward">
  
    <p id="reward-meta">çŸ¥è¯† & æƒ…æ€€ | äºŒè€…å…¼å¾—</p>
  
  <button id="reward-btn">
    
    <span>æ„Ÿè°¢æ‚¨çš„å…³å¿ƒ</span>
  </button>
  <div id="reward-qrcode">
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/wechat.png" alt="å¾®ä¿¡æ‰«ä¸€æ‰«">
        <p class="qrcode-meta">å¾®ä¿¡æ‰«ä¸€æ‰«</p>
      </div>
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/alipay.png" alt="æ”¯ä»˜å®æ‰«ä¸€æ‰«">
        <p class="qrcode-meta">æ”¯ä»˜å®æ‰«ä¸€æ‰«</p>
      </div>
    
  </div>

</div>

<script>
  (() => {
    let button = document.querySelector('#reward-btn'),
      qrcode = document.querySelector('#reward-qrcode'),
      display = false;
    
    button.addEventListener('click', () => {
      qrcode.style.display = display ? 'none' : 'block'
      display = !display
    }, false)
  })()
</script>
  

  <div class="article-footer">
    <div class="article-meta pull-left">
      <span>
        
          <i class="iconfont icon-06tags"></i>æ ‡ç­¾: 
          
          <span class="span--tag">
            <a href="/tags/Metasploit/">
              #Metasploit
            </a>
          </span>
          
        
      </span>
    </div>
    <div class="article-meta pull-right">
    </div>
  </div>
</div>


  <aside id="sidebar">
    <p id="sidebar-header"></p>
    <ol id="sidebar-toc"></ol>
  </aside>
  <script async>setTimeout(generateToc, 10);</script>


  <nav class="post-navigation">
    
      <div class="nav-pre">
        <i class="iconfont icon-prev"></i>
        ä¸Šä¸€ç¯‡:
        <a href="/2021/12Metasploit/" target="_self">Metasploitç°¡ä»‹</a>
      </div>
    
    
      <div class="nav-next">
        ä¸‹ä¸€ç¯‡:
        <a href="/2021/15Metasploit%E5%AE%A2%E6%88%B6%E7%AB%AF%E6%94%BB%E6%93%8A/" target="_self">Metasploitå®¢æˆ¶ç«¯æ”»æ“Š</a>
        <i class="iconfont icon-next"></i>
      </div>
    
  </nav>

  
    <a href="#comment" class="comment-anchor"></a>
<div class="comment-title"><i class="iconfont icon-footprint"></i> ç•™ä¸‹è¶³è¿¹ <i class="iconfont icon-footprint"></i></div>
<div id="vcomments"></div>

<script defer>
  if( true ) {
    let path = getRealPath()
    new Valine({
      el: "#vcomments",
      appId: "E4f1KI8G9DKenPGcXCkfpCMV-gzGzoHsz",
      appKey: "6VNHrdDAu0JKJXxyMajHk6qD",
      notify: false,
      verify: false,
      avatar: "robohash",
      placeholder: "æ­£ç¡®å¡«å†™é‚®ç®±, æ‰èƒ½åŠæ—¶æ”¶åˆ°å›å¤å“¦â™ª(^âˆ‡^*)",
      path
    });
  }
</script>
   

  
    <script defer>
const valineAPI = (() => {
  try {
    AV.init("E4f1KI8G9DKenPGcXCkfpCMV-gzGzoHsz", "6VNHrdDAu0JKJXxyMajHk6qD");
  } catch(error) {}
  const isExist = (identity) => {
    identity = identity || getRealPath();
    let query = new AV.Query('Timer');
    return new Promise((resolve, reject) => {
      query.equalTo("identity", identity);
      query.find().then(results => {
        resolve(results.length > 0);
      }, error => reject(error));
    })
  }

  const _get = (identity) => {
    let query = null;
    if(identity && identity instanceof Array){
      let querys = [];
      for(let i = 0; i < identity.length; ++i) {
        querys[i] = new AV.Query('Timer');
        querys[i].equalTo('identity', identity[i]);
      }
      query = AV.Query.or.apply(null ,querys);
    } else {
      identity = identity || getRealPath();
      query = new AV.Query("Timer");
      query.equalTo("identity", identity);
    }

    return new Promise((resolve, reject) => {
      query.find()
      .then(results => resolve(results))
      .catch(error => reject(error))
    })
  }

  const create = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let Todo = AV.Object.extend('Timer');
      let todo = new Todo();
      todo.set("times", 1);
      todo.set("identity", identity);
      todo.save().then(res => resolve(true), error => reject(error));
    })
  }

  const update = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let query = new AV.Query('Timer');
      query.equalTo("identity", identity);
      query.find().then(todos => {
        todos.forEach(todo => {
          todo.set("times", todo.attributes.times + 1);
        });
        return AV.Object.saveAll(todos);
      }).then(todos => resolve(true), error => reject(error));
    })
  }

  return {
    isExist,
    _get,
    update,
    create
  }
})()

const calcAndWriteTimes = () => {
  let isPost = true;

  let timerAllDOM = document.querySelectorAll(".article-timer");

  if(isPost) {
    let identity = timerAllDOM[0].getAttribute("data-identity");
    valineAPI.isExist(identity)
    .then(exist => {
      if(exist) {
        return valineAPI.update(identity);
      }
      return new Promise(resolve => resolve(true));
    })
    .then( succuess => valineAPI._get(identity))
    .then( result => timerAllDOM[0].innerText = result[0].attributes.times)
    .catch(error => console.log(error.message))
    return ;
  }

  let timerDOMCache = {};

  for(let timerDOM of timerAllDOM) {
    let identity = timerDOM.getAttribute("data-identity");
    if(timerDOMCache.hasOwnProperty(identity)){
      timerDOMCache[identity].dom.push(timerDOM);
    }else{
      timerDOMCache[identity] = {
        dom: [timerDOM],
        times: undefined
      };
    }
  }

  let identities = Object.keys(timerDOMCache);
  valineAPI._get(identities).then(results => {
    for(let result of results) {
      let {identity, times} = result.attributes;
      timerDOMCache[identity].times = times;
      timerDOMCache[identity].dom.map(item => item.innerText = times);
    }
    for(let identity of identities) {
      if(timerDOMCache[identity].times){
        continue;
      }
      timerDOMCache[identity].dom.map(item => item.innerText = 1);
      valineAPI.create(identity);
    }
  }).catch(error => console.log(error.message))
}

if(true){
  calcAndWriteTimes();
}
</script>
   

</div>


      <footer>
  <p class="site-info">
    åšå®¢å·²èŒèŒå“’è¿è¡Œ<span id="time-to-now"></span><span class="my-face">(â—'â—¡'â—)ï¾‰â™¥</span>
    <br>
    Theme - <a href="https://github.com/dongyuanxin/theme-bmw">BMW</a> | Made With ğŸ’— | Powered by <a target="_blank" rel="noopener" href="https://godbmw.com/">GodBMW</a>
    <br>
    
  </p>
</footer>



<script>
const timeToNowDOM = document.querySelector("#time-to-now");
const startTimestamp = new Date(2015, 0, 1).getTime();

const updateTimeStr = () => {
  let offset = parseInt(
      (new Date().getTime() - startTimestamp) / 1000,
      10
    ),
    day = Math.floor(offset / 86400),
    hour = Math.floor((offset % 86400) / 3600),
    minute = Math.floor(((offset % 86400) % 3600) / 60),
    second = Math.floor(((offset % 86400) % 3600) % 60);
  timeToNowDOM.innerHTML =
    day + "å¤©" + hour + "å°æ—¶" + minute + "åˆ†é’Ÿ" + second + "ç§’";
  setTimeout(updateTimeStr, 500);
}

setTimeout(updateTimeStr, 500);
</script>


      <div class="back-to-top hidden">
  <span>
    <i class="iconfont icon-60"></i><span></span>%
  </span>
</div>

<script>
const updateIconToTop = percent => {
  let dom = document.querySelector(".back-to-top span span");
  dom.innerText = percent;
  if(percent < 1) {
    document.querySelector(".back-to-top").className = "back-to-top hidden";
  } else {
    document.querySelector(".back-to-top").className = "back-to-top";
  }
}

const handleScoll = () => {
  let isRunning = false;
  return () => {
    if (isRunning) return;
    isRunning = true;
    window.requestAnimationFrame(timestamp => {
      let scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop,
        scrollHeight =
          document.documentElement.scrollHeight ||
          document.body.scrollHeight,
        clientHeight =
          document.documentElement.clientHeight ||
          document.body.clientHeight;
      isRunning = false;
      if (scrollTop <= 1) {
        updateIconToTop(0);
        return;
      }
      if (scrollTop + clientHeight >= scrollHeight) {
        updateIconToTop(100);
      } else {
        updateIconToTop(parseInt(
          100 * scrollTop / (scrollHeight - clientHeight),
          10
        ));
      }
    });
  };
}

const backToTop = () => {
  let scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop,
    delay = 10,
    time = 200;
  if (scrollTop <= 20) {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
    return;
  }
  let step = Math.ceil(scrollTop * delay / time);
  let timer = setInterval(() => {
    scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop;
    if (scrollTop - step <= 0) {
      document.documentElement.scrollTop = 0;
      document.body.scrollTop = 0;
      clearInterval(timer);
    } else {
      document.documentElement.scrollTop = scrollTop - step;
      document.body.scrollTop = scrollTop - step;
    }
  }, delay);
}

document.addEventListener("scroll", handleScoll(), false);

document.querySelector(".back-to-top").addEventListener("click", backToTop, false);

</script>

    </div>

    
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  (() => {
    const mathjaxConfig = {
      showProcessingMessages: false, //å…³é—­jsåŠ è½½è¿‡ç¨‹ä¿¡æ¯
      messageStyle: "none", //ä¸æ˜¾ç¤ºä¿¡æ¯
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]], //è¡Œå†…å…¬å¼é€‰æ‹©ç¬¦
        displayMath: [["$$", "$$"], ["\\[", "\\]"]], //æ®µå†…å…¬å¼é€‰æ‹©ç¬¦
        skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //é¿å¼€æŸäº›æ ‡ç­¾
      },
      "HTML-CSS": {
        availableFonts: ["STIX", "TeX"], //å¯é€‰å­—ä½“
        showMathMenu: false //å…³é—­å³å‡»èœå•æ˜¾ç¤º
      }
    }

    let mathjaxInterval = setInterval(() => {
      if(!window.MathJax){
        return;
      }
      window.MathJax.Hub.Config(mathjaxConfig)
      window.MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.getElementById('app')])

      clearInterval(mathjaxInterval)
    }, 10)    
  })()
</script>
    

    <script src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script>
<script async>
  let fancyTimer = setInterval(function(){
    if(!window.$){
      return;
    }
    $(document).ready(function() {
      $(".post img").each(function () {
        if($(this).parent().get(0).tagName.toLowerCase() === "a") {
          return;
        }
        // $(this).attr("data-fancybox", "gallery"); // if you add 'data-fancybox', img will display after showed
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "gallery");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      });
      
      clearInterval(fancyTimer);
    });
  }, 10);
</script>

    
  </body>

</html>
